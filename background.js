!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).splitio=t()}(this,(function(){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function r(e,t){var n;if(l(e))for(var r=Object.keys(e),i=0;i<r.length&&!n;i++){var s=r[i];t(e[s],s,e)&&(n=e[s])}else if(Array.isArray(e))for(i=0;i<e.length&&!n;i++){t(e[i],i,e)&&(n=e[i])}return n}function i(e,t){if(Array.isArray(e)&&"function"==typeof t)for(var n=0;n<e.length;n++)if(!0===t(e[n],n,e))return n;return-1}function s(e,t){return Object.keys(e).forEach((function(n){return t(e[n],n,e)})),e}function o(e,t,n){var r=n;try{var i=t.split("."),s=e;i.forEach((function(e){return s=s[e]})),void 0!==s&&(r=s)}catch(e){}return r}function a(e){return!0===e||!1===e}function u(e){return e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&(Number.isFinite?Number.isFinite(e):isFinite(e))}function c(e){return e instanceof Number&&(e=e.valueOf()),e!=e}function l(e){return null!==e&&"object"==typeof e&&(e.constructor===Object||null!=e.constructor&&"Object"===e.constructor.name)}function f(e){return"string"==typeof e||e instanceof String}function h(e){return f(e)?e.toUpperCase():e}function p(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var s=e;if(l(t)&&Object.keys(t).forEach((function(e){var n=t[e];l(n)&&(n=s[e]&&l(s[e])?p({},s[e],n):p({},n)),void 0!==n&&(s[e]=n)})),r&&r.length){var o=r.splice(0,1)[0];s=p.apply(void 0,n([s,o],r,!1))}return s}function g(e,t){return!(!f(e)||!f(t))&&e.slice(0,t.length)===t}function d(e){if("number"==typeof e)return e;if(l(e)&&"function"==typeof e.valueOf){var t=e.valueOf();e=l(t)?t+"":t}return"string"!=typeof e?0===e?e:+e:+(e=e.replace(/^\s+|\s+$/g,""))}function m(e){if(null==e)return"";if("string"==typeof e)return e;if(Array.isArray(e))return e.map((function(e){return f(e)?e:""}))+"";var t=e+"";return"0"===t&&1/e===Number.NEGATIVE_INFINITY?"-0":t}function v(e){var t={};return e.filter((function(e){return!Object.prototype.hasOwnProperty.call(t,e)&&(t[e]=!0)}))}var y="control",b={treatment:y,config:null},S="unknown",T="IMPRESSION",E="EVENT",w="DEBUG",_="OPTIMIZED",k="localhost",C="standalone",N="producer",R="consumer",A="consumer_partial",O="MEMORY",I="LOCALSTORAGE",L="PLUGGABLE",D="GRANTED",M="DECLINED",x="UNKNOWN";var F=223,K=315,U=318,P=319,j="settings",B="Factory instantiation",z=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/;function G(e,t,n,r){if(void 0===r&&(r="split name"),null==t)e.error(K,[n,r]);else if(f(t)){if(z.test(t)&&(e.warn(214,[n,r,t]),t=t.trim()),t.length>0)return t;e.error(P,[n,r])}else e.error(U,[n,r]);return!1}function q(e,t,n,r,i){if(void 0===r&&(r="split_names"),void 0===i&&(i="split name"),Array.isArray(t)&&t.length>0){var s=[];if(t.forEach((function(t){var r=G(e,t,n,i);r&&s.push(r)})),s.length)return v(s)}return e.error(320,[n,r]),!1}var W=[{type:"byName",maxLength:400,queryParam:"names="},{type:"byPrefix",maxLength:50,queryParam:"prefixes="}];function H(e,t,n){var r,i,s={validFilters:[],queryString:null,groupedFilters:{byName:[],byPrefix:[]}};return t?n!==C?(e.warn(219,[C]),s):Array.isArray(t)&&0!==t.length?(s.validFilters=t.filter((function(t,n){return t&&(r=t.type,W.some((function(e){return e.type===r})))&&Array.isArray(t.values)?(s.groupedFilters[t.type]=s.groupedFilters[t.type].concat(t.values),!0):(e.warn(220,[n]),!1);var r})),W.forEach((function(t){var n=t.type,r=t.maxLength;s.groupedFilters[n].length>0&&(s.groupedFilters[n]=function(e,t,n,r){var i=q(e,n,j,t+" filter",t+" filter value");if(i){if(i.length>r)throw new Error(r+" unique values can be specified at most for '"+t+"' filter. You passed "+i.length+". Please consider reducing the amount or using other filter.");i.sort()}return i||[]}(e,n,s.groupedFilters[n],r))})),s.queryString=(r=s.groupedFilters,i=[],W.forEach((function(e){var t=e.type,n=e.queryParam,s=r[t];s.length>0&&i.push(n+s.map((function(e){return encodeURIComponent(e)})).join(","))})),i.length>0?"&"+i.join("&"):null),e.debug(39,[s.queryString]),s):(e.warn(221),s):s}function Q(e,t,n,r){if(null==t)return e.error(K,[n,r]),!1;if(u(t))return e.warn(213,[n,r,t]),m(t);if(f(t)){if((t=t.trim()).length>0&&t.length<=250)return t;0===t.length?e.error(P,[n,r]):t.length>250&&e.error(316,[n,r])}else e.error(U,[n,r]);return!1}function V(e,t,n){if(l(t)){var r=Q(e,t.matchingKey,n,"matchingKey"),i=Q(e,t.bucketingKey,n,"bucketingKey");return r&&i?{matchingKey:r,bucketingKey:i}:(e.error(317,[n]),!1)}return Q(e,t,n,"key")}var J=/[A-Z]/,Y="traffic_type";function Z(e,t,n){if(null==t)e.error(K,[n,Y]);else if(f(t)){if(0!==t.length)return J.test(t)&&(e.warn(216,[n]),t=t.toLowerCase()),t;e.error(P,[n,Y])}else e.error(U,[n,Y]);return!1}var $={mode:C,core:{authorizationKey:void 0,key:void 0,trafficType:void 0,labelsEnabled:!0,IPAddressesEnabled:void 0},scheduler:{featuresRefreshRate:30,segmentsRefreshRate:60,telemetryRefreshRate:3600,impressionsRefreshRate:300,offlineRefreshRate:15,eventsPushRate:60,eventsQueueSize:500,impressionsQueueSize:3e4,pushRetryBackoffBase:1},urls:{sdk:"https://sdk.split.io/api",events:"https://events.split.io/api",auth:"https://auth.split.io/api",streaming:"https://streaming.split.io",telemetry:"https://telemetry.split.io/api"},storage:void 0,debug:void 0,impressionListener:void 0,version:void 0,integrations:void 0,streamingEnabled:!0,sync:{splitFilters:void 0,impressionsMode:_,localhostMode:void 0},log:void 0};function X(e){return Math.round(1e3*e)}function ee(e,t){var n=t.defaults,r=t.runtime,i=t.storage,s=t.integrations,a=t.logger,u=t.localhost,c=t.consent,l=p({},$,n,e),f=a(l);l.log=f,l.sync.impressionsMode=function(e,t){return t=h(t),[w,_].indexOf(t)>-1?t:(e.error(321,["impressionsMode",[w,_],_]),_)}(f,l.sync.impressionsMode);var g,d,m,v=l.scheduler,y=l.startup;if(v.featuresRefreshRate=X(v.featuresRefreshRate),v.segmentsRefreshRate=X(v.segmentsRefreshRate),v.offlineRefreshRate=X(v.offlineRefreshRate),v.eventsPushRate=X(v.eventsPushRate),v.telemetryRefreshRate=X((g="telemetryRefreshRate",(d=v.telemetryRefreshRate)>=(m=60)?d:(f.error(326,[g,m]),m))),void 0===o(e,"scheduler.impressionsRefreshRate")&&l.sync.impressionsMode===w&&(v.impressionsRefreshRate=60),v.impressionsRefreshRate=X(v.impressionsRefreshRate),v.metricsRefreshRate&&f.warn("`metricsRefreshRate` will be deprecated soon. For configuring telemetry rates, update `telemetryRefreshRate` value in configs"),y.requestTimeoutBeforeReady=X(y.requestTimeoutBeforeReady),y.readyTimeout=X(y.readyTimeout),y.eventsFirstPushWindow=X(y.eventsFirstPushWindow),l.mode=function(e,t){if("localhost"===e)return k;if(-1===[C,N,R,A].indexOf(t))throw Error("Invalid mode provided");return t}(l.core.authorizationKey,l.mode),i&&(l.storage=i(l)),t.acceptKey){var b=l.core.key;if(l.mode===k&&void 0===b?l.core.key="localhost_key":l.core.key=V(f,b,"Client instantiation"),t.acceptTT){var S=l.core.trafficType;void 0!==S&&(l.core.trafficType=Z(f,S,"Client instantiation"))}}l.runtime=r(l),s&&(l.integrations=s(l)),u&&(l.sync.localhostMode=u(l)),!1!==l.streamingEnabled&&(l.streamingEnabled=!0,v.pushRetryBackoffBase=X(v.pushRetryBackoffBase));var T=H(f,l.sync.splitFilters,l.mode);return l.sync.splitFilters=T.validFilters,l.sync.__splitFiltersValidation=T,l.userConsent=c(l),l}
/*
    Adaptation of "object-assign" library (https://www.npmjs.com/package/object-assign)
    exported as an ES module instead of CommonJS, to avoid extra configuration steps when using
    the ESM build of the SDK with tools that doesn't support CommonJS by default (e.g. Rollup).

    object-assign
    (c) Sindre Sorhus
    @license MIT
    */var te=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;function ie(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}var se=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var n,r,i=ie(e),s=1;s<arguments.length;s++){for(var o in n=Object(arguments[s]))ne.call(n,o)&&(i[o]=n[o]);if(te){r=te(n);for(var a=0;a<r.length;a++)re.call(n,r[a])&&(i[r[a]]=n[r[a]])}}return i},oe=function(){function e(e){var t=this;this.__mapKeysData__=[],this.__mapValuesData__=[],Array.isArray(e)&&e.forEach((function(e){t.set(e[0],e[1])}))}return e.prototype.clear=function(){this.__mapKeysData__.length&&(this.__mapKeysData__.length=0,this.__mapValuesData__.length=0)},e.prototype.set=function(e,t){var n=this.__mapKeysData__.indexOf(e);return-1===n&&(n=this.__mapKeysData__.push(e)-1),this.__mapValuesData__[n]=t,this},e.prototype.delete=function(e){var t=this.__mapKeysData__.indexOf(e);return-1!==t&&(this.__mapKeysData__.splice(t,1),this.__mapValuesData__.splice(t,1),!0)},e.prototype.get=function(e){var t=this.__mapKeysData__.indexOf(e);if(-1!==t)return this.__mapValuesData__[t]},Object.defineProperty(e.prototype,"size",{get:function(){return this.__mapKeysData__.length},enumerable:!1,configurable:!0}),e}();var ae="function"==typeof Array.from&&"function"==typeof Map&&Map.prototype&&Map.prototype.values?Map:oe,ue={DEBUG:"DEBUG",INFO:"INFO",WARN:"WARN",ERROR:"ERROR",NONE:"NONE"},ce={DEBUG:1,INFO:2,WARN:3,ERROR:4,NONE:5};function le(e){return!!r(ue,(function(t){return e===t}))}function fe(e,t){void 0===e&&(e=""),void 0===t&&(t=[]);var n=0;return e.replace(/%s/g,(function(){return t[n++]}))}var he,pe={prefix:"splitio",logLevel:ue.NONE,showLevel:!0},ge=function(){function e(e,t){this.options=se({},pe,e),this.codes=t||new ae,this.logLevel=ce[this.options.logLevel]}return e.prototype.setLogLevel=function(e){this.options.logLevel=e,this.logLevel=ce[e]},e.prototype.debug=function(e,t){this._shouldLog(ce.DEBUG)&&this._log(ue.DEBUG,e,t)},e.prototype.info=function(e,t){this._shouldLog(ce.INFO)&&this._log(ue.INFO,e,t)},e.prototype.warn=function(e,t){this._shouldLog(ce.WARN)&&this._log(ue.WARN,e,t)},e.prototype.error=function(e,t){this._shouldLog(ce.ERROR)&&this._log(ue.ERROR,e,t)},e.prototype._log=function(e,t,n){if("number"==typeof t){var r=this.codes.get(t);t=r?fe(r,n):"Message code "+t+(n?", with args: "+n.toString():"")}else n&&(t=fe(t,n));var i=this._generateLogMessage(e,t);console.log(i)},e.prototype._generateLogMessage=function(e,t){var n="";return this.options.showLevel&&(n+="["+e+"]"+(e===ue.INFO||e===ue.WARN?" ":"")+" "),this.options.prefix&&(n+=this.options.prefix+" => "),n+t},e.prototype._shouldLog=function(e){return e>=this.logLevel},e}();try{var de=localStorage.getItem("splitio_debug")||"";he=/^(enabled?|on)/i.test(de)?ue.DEBUG:le(de)?de:ue.NONE}catch(at){}var me={startup:{requestTimeoutBeforeReady:5,retriesOnFailureBeforeReady:1,readyTimeout:10,eventsFirstPushWindow:10},userConsent:D,version:"browserjs-0.6.0",debug:he};var ve=function(){function e(){}return e.prototype.addSplits=function(e){var t=this;return e.map((function(e){return t.addSplit(e[0],e[1])}))},e.prototype.removeSplits=function(e){var t=this;return e.map((function(e){return t.removeSplit(e)}))},e.prototype.getSplits=function(e){var t=this,n={};return e.forEach((function(e){n[e]=t.getSplit(e)})),n},e.prototype.getAll=function(){var e=this;return this.getSplitNames().map((function(t){return e.getSplit(t)}))},e.prototype.checkCache=function(){return!1},e.prototype.killLocally=function(e,t,n){var r=this.getSplit(e);if(r){var i=JSON.parse(r);if(!i.changeNumber||i.changeNumber<n){i.killed=!0,i.defaultTreatment=t,i.changeNumber=n;var s=JSON.stringify(i);return this.addSplit(e,s)}}return!1},e}();function ye(e){for(var t=e.conditions||[],n=0;n<t.length;n++)for(var r=t[n].matcherGroup.matchers,i=0;i<r.length;i++)if("IN_SEGMENT"===r[i].matcherType)return!0;return!1}var be=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.splitsCache={},t.ttCache={},t.changeNumber=-1,t.splitsWithSegmentsCount=0,t}return t(n,e),n.prototype.clear=function(){this.splitsCache={},this.ttCache={},this.changeNumber=-1,this.splitsWithSegmentsCount=0},n.prototype.addSplit=function(e,t){var n=this.getSplit(e);if(n){var r=JSON.parse(n);if(r.trafficTypeName){var i=r.trafficTypeName;this.ttCache[i]--,this.ttCache[i]||delete this.ttCache[i]}ye(r)&&this.splitsWithSegmentsCount--}var s=JSON.parse(t);if(s){this.splitsCache[e]=t;var o=s.trafficTypeName;return o&&(this.ttCache[o]||(this.ttCache[o]=0),this.ttCache[o]++),ye(s)&&this.splitsWithSegmentsCount++,!0}return!1},n.prototype.removeSplit=function(e){var t=this.getSplit(e);if(t){delete this.splitsCache[e];var n=JSON.parse(t),r=n.trafficTypeName;return r&&(this.ttCache[r]--,this.ttCache[r]||delete this.ttCache[r]),ye(n)&&this.splitsWithSegmentsCount--,!0}return!1},n.prototype.getSplit=function(e){return this.splitsCache[e]||null},n.prototype.setChangeNumber=function(e){return this.changeNumber=e,!0},n.prototype.getChangeNumber=function(){return this.changeNumber},n.prototype.getSplitNames=function(){return Object.keys(this.splitsCache)},n.prototype.trafficTypeExists=function(e){return u(this.ttCache[e])&&this.ttCache[e]>0},n.prototype.usesSegments=function(){return-1===this.getChangeNumber()||this.splitsWithSegmentsCount>0},n}(ve),Se=function(){function e(){}return e.prototype.registerSegments=function(e){return!1},e.prototype.setChangeNumber=function(e,t){return!0},e.prototype.getChangeNumber=function(e){return-1},e.prototype.resetSegments=function(e){return!0},e}(),Te=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.segmentCache={},t}return t(n,e),n.prototype.clear=function(){this.segmentCache={}},n.prototype.addToSegment=function(e){return this.segmentCache[e]=!0,!0},n.prototype.removeFromSegment=function(e){return delete this.segmentCache[e],!0},n.prototype.isInSegment=function(e){return!0===this.segmentCache[e]},n.prototype.resetSegments=function(e){var t,n=this,r=!1,i=Object.keys(this.segmentCache);if(0===e.length&&i.length===e.length)return r;if(i.length!==e.length)r=!0,this.segmentCache={},e.forEach((function(e){n.addToSegment(e)}));else{for(t=0;t<e.length&&this.isInSegment(e[t]);t++);t<e.length&&(r=!0,this.segmentCache={},e.forEach((function(e){n.addToSegment(e)})))}return r},n.prototype.getRegisteredSegments=function(){return Object.keys(this.segmentCache)},n.prototype.getKeysCount=function(){return 1},n}(Se),Ee=function(){function e(e){void 0===e&&(e=0),this.maxQueue=e,this.queue=[]}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e){var t;(t=this.queue).push.apply(t,e),this.maxQueue>0&&this.queue.length>=this.maxQueue&&this.onFullQueue&&this.onFullQueue()},e.prototype.clear=function(){this.queue=[]},e.prototype.state=function(){return this.queue},e.prototype.isEmpty=function(){return 0===this.queue.length},e}(),we=function(){function e(e){void 0===e&&(e=0),this.maxQueue=e,this.queue=[],this.queueByteSize=0}return e.prototype.setOnFullQueueCb=function(e){this.onFullQueue=e},e.prototype.track=function(e,t){return void 0===t&&(t=0),this.queueByteSize+=t,this.queue.push(e),this._checkForFlush(),!0},e.prototype.clear=function(){this.queue=[],this.queueByteSize=0},e.prototype.state=function(){return this.queue},e.prototype.isEmpty=function(){return 0===this.queue.length},e.prototype._checkForFlush=function(){(this.queueByteSize>5242880||this.maxQueue>0&&this.queue.length>=this.maxQueue)&&this.onFullQueue&&this.onFullQueue()},e}();function _e(e){return e-e%36e5}var ke=function(){function e(){this.cache={}}return e.prototype._makeKey=function(e,t){return e+"::"+_e(t)},e.prototype.track=function(e,t,n){var r=this._makeKey(e,t),i=this.cache[r];this.cache[r]=i?i+n:n},e.prototype.state=function(){return this.cache},e.prototype.clear=function(){this.cache={}},e.prototype.isEmpty=function(){return 0===Object.keys(this.cache).length},e}();function Ce(e){var t=Math.min(22,Math.max(0,Math.ceil(Math.log(e)/Math.log(1.5))));return c(t)?0:t}function Ne(){return Math.random()<=.001}var Re=function(){function e(){this.notReadyUsage=0,this.impressionStats=[0,0,0],this.eventStats=[0,0],this.lastSync={},this.httpErrors={},this.httpLatencies={},this.authRejections=0,this.tokenRefreshes=0,this.streamingEvents=[],this.tags=[],this.exceptions={},this.latencies={}}return e.prototype.getTimeUntilReady=function(){return this.timeUntilReady},e.prototype.recordTimeUntilReady=function(e){this.timeUntilReady=e},e.prototype.getTimeUntilReadyFromCache=function(){return this.timeUntilReadyFromCache},e.prototype.recordTimeUntilReadyFromCache=function(e){this.timeUntilReadyFromCache=e},e.prototype.getNonReadyUsage=function(){return this.notReadyUsage},e.prototype.recordNonReadyUsage=function(){this.notReadyUsage++},e.prototype.getImpressionStats=function(e){return this.impressionStats[e]},e.prototype.recordImpressionStats=function(e,t){this.impressionStats[e]+=t},e.prototype.getEventStats=function(e){return this.eventStats[e]},e.prototype.recordEventStats=function(e,t){this.eventStats[e]+=t},e.prototype.getLastSynchronization=function(){return this.lastSync},e.prototype.recordSuccessfulSync=function(e,t){this.lastSync[e]=t},e.prototype.popHttpErrors=function(){var e=this.httpErrors;return this.httpErrors={},e},e.prototype.recordHttpError=function(e,t){this.httpErrors[e]||(this.httpErrors[e]={}),this.httpErrors[e][t]?this.httpErrors[e][t]++:this.httpErrors[e][t]=1},e.prototype.popHttpLatencies=function(){var e=this.httpLatencies;return this.httpLatencies={},e},e.prototype.recordHttpLatency=function(e,t){this.httpLatencies[e]||(this.httpLatencies[e]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.httpLatencies[e][Ce(t)]++},e.prototype.popAuthRejections=function(){var e=this.authRejections;return this.authRejections=0,e},e.prototype.recordAuthRejections=function(){this.authRejections++},e.prototype.popTokenRefreshes=function(){var e=this.tokenRefreshes;return this.tokenRefreshes=0,e},e.prototype.recordTokenRefreshes=function(){this.tokenRefreshes++},e.prototype.popStreamingEvents=function(){return this.streamingEvents.splice(0)},e.prototype.recordStreamingEvents=function(e){this.streamingEvents.length<20&&this.streamingEvents.push(e)},e.prototype.popTags=function(){return this.tags.splice(0)},e.prototype.addTag=function(e){this.tags.length<10&&this.tags.push(e)},e.prototype.getSessionLength=function(){return this.sessionLength},e.prototype.recordSessionLength=function(e){this.sessionLength=e},e.prototype.popExceptions=function(){var e=this.exceptions;return this.exceptions={},e},e.prototype.recordException=function(e){this.exceptions[e]?this.exceptions[e]++:this.exceptions[e]=1},e.prototype.popLatencies=function(){var e=this.latencies;return this.latencies={},e},e.prototype.recordLatency=function(e,t){this.latencies[e]||(this.latencies[e]=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),this.latencies[e][Ce(t)]++},e}();function Ae(e){return{splits:new be,segments:new Te,impressions:new Ee(e.impressionsQueueSize),impressionCounts:e.optimize?new ke:void 0,events:new we(e.eventsQueueSize),telemetry:e.mode!==k&&Ne()?new Re:void 0,destroy:function(){this.splits.clear(),this.segments.clear(),this.impressions.clear(),this.impressionCounts&&this.impressionCounts.clear(),this.events.clear()},shared:function(){return{splits:this.splits,segments:new Te,impressions:this.impressions,impressionCounts:this.impressionCounts,events:this.events,telemetry:this.telemetry,destroy:function(){this.splits=new be,this.segments.clear()}}}}}function Oe(e){var t=Ae(e);return t.splits.checkCache=function(){return!0},t}Ae.type=O,Oe.type=O;var Ie=ue.NONE;function Le(e){var t=e.treatment;return e.keys?{conditionType:"WHITELIST",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"WHITELIST",negate:!1,whitelistMatcherData:{whitelist:f(e.keys)?[e.keys]:e.keys}}]},partitions:[{treatment:t,size:100}],label:"whitelisted "+t}:{conditionType:"ROLLOUT",matcherGroup:{combiner:"AND",matchers:[{keySelector:null,matcherType:"ALL_KEYS",negate:!1}]},partitions:[{treatment:t,size:100}],label:"default rule"}}function De(e,t,n,r){void 0===r&&(r="task");var i,s,o=!1,a=!1,u=0;function c(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return o=!0,e.debug(37,[r]),t.apply(void 0,n).then((function(e){return o=!1,e}))}function l(e){return c.apply(void 0,i).then((function(t){return a&&e===u&&(s=setTimeout(l,n,e)),t}))}return{execute:c,isExecuting:function(){return o},start:function(){for(var t=[],s=0;s<arguments.length;s++)t[s]=arguments[s];if(!a)return a=!0,u++,i=t,e.debug(36,[r,n]),l(u)},stop:function(){a=!1,s&&(e.debug(38,[r]),clearTimeout(s),s=void 0)},isRunning:function(){return a}}}var Me="state::splits-arrived",xe="state::splits-cache-loaded",Fe="state::segments-arrived",Ke="init::timeout",Ue="init::ready",Pe="init::cache-ready",je="state::update";function Be(e,t,n,r){return De(r.log,function(e,t,n,r){var i=r.log,o=t.splits,a=!0;return function(){var t=[],u=null,c={};try{c=e(r)}catch(e){u=e,i.error(304,[e])}return!u&&c?(i.debug(30,[JSON.stringify(c)]),s(c,(function(e,n){t.push([n,JSON.stringify({name:n,status:"ACTIVE",killed:!1,trafficAllocation:100,defaultTreatment:y,conditions:e.conditions||[],configurations:e.configurations,trafficTypeName:e.trafficTypeName})])})),Promise.all([o.clear(),o.addSplits(t)]).then((function(){return n.splits.emit(Me),a&&(a=!1,Promise.resolve(o.checkCache()).then((function(e){e&&n.splits.emit(xe),n.segments.emit(Fe)}))),!0}))):Promise.resolve(!0)}}(e,t,n,r),r.scheduler.offlineRefreshRate,"offlineUpdater")}function ze(){return Promise.resolve()}var Ge,qe=(Ge=function(){var e={emptyMock:"1"};return function(t){var n,r,i=t.features||{};if(n=i,!((r=Object.keys(n)).length!==Object.keys(e).length?(e=n,1):r.some((function(t){var r,i,s=!e[t],o=typeof(r=e[t])!=typeof(i=n[t])||("string"==typeof r?r!==i:r.treatment!==i.treatment||r.config!==i.config),a=s||o;return a&&(e=n),a}))))return!1;var o={};return s(i,(function(e,t){var n=e,r=null;l(e)&&(n=e.treatment,r=e.config||r);var i={};null!==r&&(i[n]=r),o[t]={trafficTypeName:"localhost",conditions:[Le({treatment:n})],configurations:i}})),o}},function(e){var t=e.settings,n=e.readiness,r=e.storage;return se(Be(Ge(),r,n,t),{flush:ze,shared:function(e,t){return{start:function(){setTimeout((function(){t.segments.emit(Fe)}),0)},stop:function(){},isRunning:function(){return!0},flush:ze}}})});function We(){return qe}qe.type="LocalhostFromObject";var He=[M,D,x];var Qe={defaults:me,acceptKey:!0,runtime:function(){return{ip:!1,hostname:!1}},storage:function(e){var t=e.storage,n=void 0===t?Ae:t,r=e.log,i=e.mode;if("function"==typeof n&&-1!==[O,I,L].indexOf(n.type)||(n=Ae,r.error(324)),i===k&&n.type===I)return Oe;if(-1===[k,C].indexOf(i)){if(n.type!==L)throw new Error("A PluggableStorage instance is required on consumer mode")}else n.type===L&&(n=Ae,r.error(324,[" It requires consumer mode."]));return n},integrations:function(e){return function(e,t,n){var r=e.integrations,i=e.log;if(!Array.isArray(r)||0===r.length)return[];var s=r.filter(t),o=r.length-s.length;return o&&i.warn(218,[o,n||""]),s}(e,(function(e){return"function"==typeof e}),"Integration items must be functions that initialize the integrations")},logger:function(e){var t,n=e.debug,r=Ie;if(void 0!==n){if(function(e){return e&&"function"==typeof e.debug&&"function"==typeof e.info&&"function"==typeof e.warn&&"function"==typeof e.error&&"function"==typeof e.setLogLevel}(n))return n;r="boolean"==typeof(t=e.debug)?t?ue.DEBUG:ue.NONE:"string"==typeof t&&le(t)?t:void 0}var i=new ge({logLevel:r||Ie});return r||i._log(ue.ERROR,"Invalid `debug` value at config. Logs will be disabled."),i},localhost:function(e){return e.sync.localhostMode&&function(e){var t=e.sync.localhostMode;if(e.mode!==k||"function"==typeof t&&"LocalhostFromObject"===t.type)return t;e.log.error(323)}(e)||We()},consent:function(e){var t=e.userConsent,n=e.log;return t=h(t),He.indexOf(t)>-1?t:(n.error(321,["userConsent",He,D]),D)}};var Ve="Global fetch API is not available.";var Je={headers:{"Cache-Control":"no-cache"}};function Ye(e){return"users="+encodeURIComponent(e)}function Ze(e,t,n){var r=e.urls,i=e.sync.__splitFiltersValidation&&e.sync.__splitFiltersValidation.queryString,s=e.sync.impressionsMode,o=function(e,t,n){var r=e.log,i=e.core.authorizationKey,s=e.version,o=e.runtime,a=o.ip,u=o.hostname,c=n&&n(),l=t&&t();l||r.error(303,[Ve]);var f={Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+i,SplitSDKVersion:s};return a&&(f.SplitSDKMachineIP=a),u&&(f.SplitSDKMachineName=u),function(e,t,n,i){void 0===t&&(t={}),void 0===n&&(n=function(){}),void 0===i&&(i=!1);var s=se({headers:t.headers?se({},f,t.headers):f,method:t.method||"GET",body:t.body},c);return l?l(e,s).then((function(e){return e.ok?(n(),e):e.text().then((function(t){return Promise.reject({response:e,message:t})}))})).catch((function(t){var s=t&&t.response,o="";if(s)switch(s.status){case 404:o="Invalid API key or resource not found.";break;default:o=t.message}else o=t.message||"Network Error";s&&403===s.status||r[i?"info":"error"](322,[s?s.status:"NO_STATUS",e,o]);var a=new Error(o);throw a.statusCode=s&&s.status,n(a),a})):Promise.reject(new Error(Ve))}}(e,t.getFetch,t.getOptions);return{getSdkAPIHealthCheck:function(){var e=r.sdk+"/version";return o(e).then((function(){return!0})).catch((function(){return!1}))},getEventsAPIHealthCheck:function(){var e=r.events+"/version";return o(e).then((function(){return!0})).catch((function(){return!1}))},fetchAuth:function(e){var t=r.auth+"/v2/auth";if(e){var i=e.map(Ye).join("&");i&&(t+="?"+i)}return o(t,void 0,n.trackHttp("to"))},fetchSplitChanges:function(e,t){var s=r.sdk+"/splitChanges?since="+e+(i||"");return o(s,t?Je:void 0,n.trackHttp("sp"))},fetchSegmentChanges:function(e,t,i){var s=r.sdk+"/segmentChanges/"+t+"?since="+e;return o(s,i?Je:void 0,n.trackHttp("se"))},fetchMySegments:function(e,t){var i=r.sdk+"/mySegments/"+encodeURIComponent(e);return o(i,t?Je:void 0,n.trackHttp("ms"))},postEventsBulk:function(e,t){var i=r.events+"/events/bulk";return o(i,{method:"POST",body:e,headers:t},n.trackHttp("ev"))},postTestImpressionsBulk:function(e,t){var i=r.events+"/testImpressions/bulk";return o(i,{method:"POST",body:e,headers:se({SplitSDKImpressionsMode:s},t)},n.trackHttp("im"))},postTestImpressionsCount:function(e,t){var i=r.events+"/testImpressions/count";return o(i,{method:"POST",body:e,headers:t},n.trackHttp("ic"))},postMetricsConfig:function(e){var t=r.telemetry+"/v1/metrics/config";return o(t,{method:"POST",body:e},n.trackHttp("te"),!0)},postMetricsUsage:function(e){var t=r.telemetry+"/v1/metrics/usage";return o(t,{method:"POST",body:e},n.trackHttp("te"),!0)}}}function $e(e,t,n,r,i,s,o,a){void 0===o&&(o=0);var u=0;return De(e,(function(){if(n.isEmpty())return Promise.resolve();var r=n.state(),c="number"==typeof r.length?r.length+" "+i:i;e[a?"debug":"info"](116,[c]);var l=JSON.stringify(s?s(r):r);return o||n.clear(),t(l).then((function(){u=0,n.clear()})).catch((function(t){o?u===o?(u=0,n.clear(),e[a?"debug":"warn"](209,[c,t])):(u++,e[a?"debug":"warn"](210,[c,t])):e[a?"debug":"warn"](209,[c,t])}))}),r,i+" submitter")}function Xe(e,t){var n,r=!1,i=e.start;e.start=function(){r=!0,n=setTimeout(i,t)};var s=e.stop;return e.stop=function(){r=!1,clearTimeout(n),s()},e.isRunning=function(){return r},e}var et="events";function tt(e){var t=e.settings,n=t.log,r=t.scheduler.eventsPushRate,i=t.startup.eventsFirstPushWindow,s=e.splitApi.postEventsBulk,o=e.storage.events,a=$e(n,s,o,r,et);return i>0&&(a=Xe(a,i)),o.setOnFullQueueCb((function(){a.isRunning()&&(n.info(115,[et]),a.execute())})),a}var nt="impressions";function rt(e,t){var n=function(e,t){var n={};if(Array.isArray(e)&&f(t))for(var r=0;r<e.length;r++){var i=e[r][t];f(i)&&(n[i]||(n[i]=[]),n[i].push(e[r]))}return n}(t,"feature"),r=[];return s(n,(function(t,n){r.push({f:n,i:t.map((function(t){return{k:t.keyName,t:t.treatment,m:t.time,c:t.changeNumber,r:e?t.label:void 0,b:t.bucketingKey?t.bucketingKey:void 0,pt:t.pt?t.pt:void 0}}))})})),r}function it(e){var t=e.settings,n=t.log,r=t.scheduler.impressionsRefreshRate,i=t.core.labelsEnabled,s=e.splitApi.postTestImpressionsBulk,o=e.storage.impressions,a=$e(n,s,o,r,nt,rt.bind(void 0,i),1);return o.setOnFullQueueCb((function(){a.isRunning()&&(n.info(115,[nt]),a.execute())})),a}function st(e){for(var t=[],n=Object.keys(e),r=0;r<n.length;r++){var i=n[r].split("::");if(2===i.length){var s=i[0],o=i[1],a={f:s,m:Number(o),rc:e[n[r]]};t.push(a)}}return{pf:t}}var ot="api_key";var at,ut,ct,lt={};function ft(e,t){var n=function(e,t){var n=!1;return null==t?e.error(K,[B,ot]):f(t)?t.length>0?n=t:e.error(P,[B,ot]):e.error(U,[B,ot]),n}(e,t);return n&&(lt[n]?(e.warn(222,[lt[n]+" factory/ies with this API Key"]),lt[n]++):(lt[n]=1,Object.keys(lt).length>1&&e.warn(222,["an instance of the Split factory"]))),n}function ht(e){var t=e();return function(){return Math.round(e()-t)}}function pt(e,t,n){return{isEmpty:function(){return!1},clear:function(){},state:function(){return{lS:e.getLastSynchronization(),mL:e.popLatencies(),mE:e.popExceptions(),hE:e.popHttpErrors(),hL:e.popHttpLatencies(),tR:e.popTokenRefreshes(),aR:e.popAuthRejections(),iQ:e.getImpressionStats(0),iDe:e.getImpressionStats(2),iDr:e.getImpressionStats(1),spC:t.getSplitNames().length,seC:n.getRegisteredSegments().length,skC:n.getKeysCount(),sL:e.getSessionLength(),eQ:e.getEventStats(0),eD:e.getEventStats(1),sE:e.popStreamingEvents(),t:e.popTags()}}}}var gt=((at={})[C]=0,at[R]=1,at[A]=2,at),dt=((ut={})[_]=0,ut[w]=1,ut),mt=((ct={}).UNKNOWN=1,ct.GRANTED=2,ct.DECLINED=3,ct);function vt(e,t){return{isEmpty:function(){return!1},clear:function(){},state:function(){var n=t.urls,r=t.scheduler,i=void 0!==t.core.key;return se(function(e,t){return{oM:gt[e],st:t.toLowerCase(),aF:Object.keys(lt).length,rF:Object.keys(lt).reduce((function(e,t){return e+lt[t]-1}),0)}}(t.mode,t.storage.type),{sE:t.streamingEnabled,rR:{sp:r.featuresRefreshRate/1e3,se:i?void 0:r.segmentsRefreshRate/1e3,ms:i?r.segmentsRefreshRate/1e3:void 0,im:r.impressionsRefreshRate/1e3,ev:r.eventsPushRate/1e3,te:r.telemetryRefreshRate/1e3},uO:{s:n.sdk!==$.urls.sdk,e:n.events!==$.urls.events,a:n.auth!==$.urls.auth,st:n.streaming!==$.urls.streaming,t:n.telemetry!==$.urls.telemetry},iQ:r.impressionsQueueSize,eQ:r.eventsQueueSize,iM:dt[t.sync.impressionsMode],iL:!!t.impressionListener,hP:!1,tR:e.getTimeUntilReady(),tC:e.getTimeUntilReadyFromCache(),nR:e.getNonReadyUsage(),t:e.popTags(),i:t.integrations&&t.integrations.map((function(e){return e.type})),uC:t.userConsent?mt[t.userConsent]:0})}}}function yt(e){var t=[it(e),tt(e)],n=function(e){var t=e.settings.log,n=e.splitApi.postTestImpressionsCount,r=e.storage.impressionCounts;if(r)return $e(t,n,r,18e5,"impression counts",st,1)}(e);n&&t.push(n);var r,i=function(e){var t=e.storage,n=t.splits,r=t.segments,i=t.telemetry,s=e.platform.now;if(i&&s){var o=e.settings,a=e.settings,u=a.log,c=a.scheduler.telemetryRefreshRate,l=e.splitApi,f=e.readiness,h=e.sdkReadinessManager,p=ht(s),g=Xe($e(u,l.postMetricsUsage,pt(i,n,r),c,"telemetry stats",void 0,0,!0),c);return f.gate.once(Pe,(function(){i.recordTimeUntilReadyFromCache(p())})),h.incInternalReadyCbCount(),f.gate.once(Ue,(function(){i.recordTimeUntilReady(p()),g.isRunning()&&$e(u,l.postMetricsConfig,vt(i,o),0,"telemetry config",void 0,0,!0).execute()})),g}}(e);return i&&t.push(i),r=t,{start:function(){r.forEach((function(e){return e.start()}))},stop:function(){r.forEach((function(e){return e.stop()}))},isRunning:function(){return r.some((function(e){return e.isRunning()}))},execute:function(){return Promise.all(r.map((function(e){return e.execute()})))},isExecuting:function(){return r.some((function(e){return e.isExecuting()}))}}}var bt,St="PUSH_NONRETRYABLE_ERROR",Tt="PUSH_RETRYABLE_ERROR",Et="PUSH_SUBSYSTEM_UP",wt="PUSH_SUBSYSTEM_DOWN",_t="MY_SEGMENTS_UPDATE",kt="MY_SEGMENTS_UPDATE_V2",Ct="SEGMENT_UPDATE",Nt="SPLIT_KILL",Rt="SPLIT_UPDATE",At="CONTROL",Ot="OCCUPANCY";function It(e){var t=e.userConsent;return!t||t===D}function Lt(e,t){return function(n){var r=n.settings,i=n.settings,s=i.log,o=i.streamingEnabled,a=n.telemetryTracker,u=e&&e(n),c=o&&u&&t?t(n,u):void 0,l=yt(n);c&&(c.on(Et,(function(){s.info(119),u.isRunning()&&(u.stop(),a.streamingEvent(70,0)),u.syncAll()})),c.on(wt,(function(){u.isRunning()?s.info(118):(s.info(117),u.start(),a.streamingEvent(70,1))})));var f=!1,h=!0;return{pollingManager:u,pushManager:c,submitter:l,start:function(){f=!0,u&&(c?(h&&(u.syncAll(),h=!1),c.start()):u.start()),It(r)&&l.start()},stop:function(){f=!1,c&&c.stop(),u&&u.isRunning()&&u.stop(),l.stop()},isRunning:function(){return f},flush:function(){return It(r)?l.execute():Promise.resolve()},shared:function(e,t,n){if(u){var r=u.add(e,t,n);return{isRunning:r.isRunning,start:function(){c?(u.isRunning()?n.splits.usesSegments()&&r.start():r.execute(),c.add(e,r)):n.splits.usesSegments()&&r.start()},stop:function(){var t=u.get(e);t&&(c&&c.remove(e),t.isRunning()&&t.stop(),u.remove(e))},flush:function(){return Promise.resolve()}}}}}}}!function(e){e.STREAMING_DISABLED="STREAMING_DISABLED",e.STREAMING_PAUSED="STREAMING_PAUSED",e.STREAMING_RESUMED="STREAMING_RESUMED",e.STREAMING_RESET="STREAMING_RESET"}(bt||(bt={}));var Dt=function(){function e(t,n,r){this.baseMillis=n||e.DEFAULT_BASE_MILLIS,this.maxMillis=r||e.DEFAULT_MAX_MILLIS,this.attempts=0,this.cb=t}return e.prototype.scheduleCall=function(){var e=this,t=Math.min(this.baseMillis*Math.pow(2,this.attempts),this.maxMillis);return this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=setTimeout((function(){e.cb()}),t),this.attempts++,t},e.prototype.reset=function(){this.attempts=0,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=void 0)},e.DEFAULT_BASE_MILLIS=1e3,e.DEFAULT_MAX_MILLIS=18e5,e}();var Mt=[/control_pri$/,/control_sec$/],xt=[10,20];function Ft(e,t,n){var r=function(e,t){var n=Mt.map((function(e){return{regex:e,hasPublishers:!0,oTime:-1,cTime:-1}})),r=!0,i=!0;return{handleOpen:function(){t.streamingEvent(0),e.emit(Et)},isStreamingUp:function(){return i&&r},handleOccupancyEvent:function(s,o,a){for(var u=0;u<n.length;u++){var c=n[u];if(c.regex.test(o)){if(t.streamingEvent(xt[u],s),a>c.oTime){c.oTime=a,c.hasPublishers=0!==s;var l=n.some((function(e){return e.hasPublishers}));i&&(!l&&r?e.emit(wt):l&&!r&&e.emit(Et)),r=l}return}}},handleControlEvent:function(s,o,a){if(s!==bt.STREAMING_RESET)for(var u=0;u<n.length;u++){var c=n[u];if(c.regex.test(o))return void(a>c.cTime&&(c.cTime=a,s===bt.STREAMING_DISABLED?(t.streamingEvent(30,0),e.emit(St)):r&&(s===bt.STREAMING_PAUSED&&i?(t.streamingEvent(30,2),e.emit(wt)):s!==bt.STREAMING_RESUMED||i||(t.streamingEvent(30,1),e.emit(Et))),i=s===bt.STREAMING_RESUMED))}else e.emit(s)}}}(t,n);return{handleOpen:function(){r.handleOpen()},handleError:function(r){var i=r;try{i=function(e){return f(e.data)&&(e.parsedData=JSON.parse(e.data)),e}(r)}catch(t){e.warn(206,[t])}var s=i.parsedData&&i.parsedData.message||i.message;e.error(305,[s]),!function(e){if(e.parsedData&&e.parsedData.code){var t=e.parsedData.code;if(n.streamingEvent(60,t),40140<=t&&t<=40149)return!0;if(4e4<=t&&t<=49999)return!1}else n.streamingEvent(40,1);return!0}(i)?t.emit(St):t.emit(Tt)},handleMessage:function(n){var i;try{if(!(i=function(e){if(e.data){var t=JSON.parse(e.data);return t.parsedData=JSON.parse(t.data),t.name&&"[meta]occupancy"===t.name&&(t.parsedData.type=Ot),t}}(n)))return}catch(t){return void e.warn(207,[t])}var s=i.parsedData,o=i.data,a=i.channel,u=i.timestamp;if(e.debug(35,[o]),r.isStreamingUp()||-1!==[Ot,At].indexOf(s.type))switch(s.type){case Rt:case Ct:case kt:case Nt:t.emit(s.type,s);break;case _t:t.emit(s.type,s,a);break;case Ot:r.handleOccupancyEvent(s.metrics.publishers,a,u);break;case At:r.handleControlEvent(s.controlType,a,u)}}}}var Kt=function(){function e(e){this.mySegmentsSyncTask=e,this.maxChangeNumber=0,this.handleNewEvent=!1,this.segmentsData=void 0,this.currentChangeNumber=-1,this.put=this.put.bind(this),this.__handleMySegmentsUpdateCall=this.__handleMySegmentsUpdateCall.bind(this),this.backoff=new Dt(this.__handleMySegmentsUpdateCall)}return e.prototype.__handleMySegmentsUpdateCall=function(){var e=this;if(this.maxChangeNumber>this.currentChangeNumber){this.handleNewEvent=!1;var t=this.maxChangeNumber;this.mySegmentsSyncTask.execute(this.segmentsData,!0).then((function(n){!1!==n&&(e.currentChangeNumber=Math.max(e.currentChangeNumber,t)),e.handleNewEvent?e.__handleMySegmentsUpdateCall():e.backoff.scheduleCall()}))}},e.prototype.put=function(e,t){e<=this.currentChangeNumber||e<=this.maxChangeNumber||(this.maxChangeNumber=e,this.handleNewEvent=!0,this.backoff.reset(),this.segmentsData=t,this.mySegmentsSyncTask.isExecuting()||this.__handleMySegmentsUpdateCall())},e}(),Ut=function(){function e(e,t){this.segmentsCache=t,this.segmentsSyncTask=e,this.maxChangeNumbers={},this.handleNewEvent=!1,this.put=this.put.bind(this),this.__handleSegmentUpdateCall=this.__handleSegmentUpdateCall.bind(this),this.backoff=new Dt(this.__handleSegmentUpdateCall)}return e.prototype.__handleSegmentUpdateCall=function(){var e=this,t=Object.keys(this.maxChangeNumbers).filter((function(t){return e.maxChangeNumbers[t]>e.segmentsCache.getChangeNumber(t)}));if(t.length>0){this.handleNewEvent=!1;var n=t.map((function(t){return e.maxChangeNumbers[t]}));this.segmentsSyncTask.execute(t,!0).then((function(r){!1!==r?t.forEach((function(t,r){e.maxChangeNumbers[t]===n[r]&&(e.maxChangeNumbers[t]=-1)})):e.backoff.scheduleCall(),e.handleNewEvent&&e.__handleSegmentUpdateCall()}))}},e.prototype.put=function(e){var t=e.changeNumber,n=e.segmentName;t<=this.segmentsCache.getChangeNumber(n)||t<=this.maxChangeNumbers[n]||(this.maxChangeNumbers[n]=t,this.handleNewEvent=!0,this.backoff.reset(),this.segmentsSyncTask.isExecuting()||this.__handleSegmentUpdateCall())},e}(),Pt=function(){function e(e,t,n,r){this.splitsCache=e,this.splitsSyncTask=t,this.splitsEventEmitter=n,this.segmentsSyncTask=r,this.maxChangeNumber=0,this.handleNewEvent=!1,this.put=this.put.bind(this),this.killSplit=this.killSplit.bind(this),this.__handleSplitUpdateCall=this.__handleSplitUpdateCall.bind(this),this.backoff=new Dt(this.__handleSplitUpdateCall)}return e.prototype.__handleSplitUpdateCall=function(){var e=this;this.maxChangeNumber>this.splitsCache.getChangeNumber()&&(this.handleNewEvent=!1,this.splitsSyncTask.execute(!0).then((function(){e.handleNewEvent?e.__handleSplitUpdateCall():(e.segmentsSyncTask&&e.segmentsSyncTask.execute(void 0,!1,!0),e.backoff.scheduleCall())})))},e.prototype.put=function(e){var t=e.changeNumber;t<=this.splitsCache.getChangeNumber()||t<=this.maxChangeNumber||(this.maxChangeNumber=t,this.handleNewEvent=!0,this.backoff.reset(),this.splitsSyncTask.isExecuting()||this.__handleSplitUpdateCall())},e.prototype.killSplit=function(e){var t=e.changeNumber,n=e.splitName,r=e.defaultTreatment;this.splitsCache.killLocally(n,r,t)&&this.splitsEventEmitter.emit(Me,!0),this.put({changeNumber:t})},e}(),jt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Bt(e){var t=String(e).replace(/[=]+$/,"");if(t.length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var n="",r=0,i=void 0,s=void 0,o=0;s=t.charAt(o++);~s&&(i=r%4?64*i+s:s,r++%4)?n+=String.fromCharCode(255&i>>(-2*r&6)):0)s=jt.indexOf(s);return n}var zt=String.fromCharCode;function Gt(e){var t,n,r,i,s;return n=function(e){if("string"!=typeof e)throw TypeError("Illegal argument: "+typeof e);var t=0;return function(){return t>=e.length?null:e.charCodeAt(t++)}}(e),i=[],s=[],r=t=function(){if(0===arguments.length)return s.join("")+zt.apply(String,i);i.length+arguments.length>1024&&(s.push(zt.apply(String,i)),i.length=0),Array.prototype.push.apply(i,arguments)},function(e,t){for(var n,r=null;null!==(n=null!==r?r:e());)n>=55296&&n<=57343&&null!==(r=e())&&r>=56320&&r<=57343?(t(1024*(n-55296)+r-56320+65536),r=null):t(n);null!==r&&t(r)}(n,(function(e){!function(e,t){var n=null;for("number"==typeof e&&(n=e,e=function(){return null});null!==n||null!==(n=e());)n<128?t(127&n):n<2048?(t(n>>6&31|192),t(63&n|128)):n<65536?(t(n>>12&15|224),t(n>>6&63|128),t(63&n|128)):(t(n>>18&7|240),t(n>>12&63|128),t(n>>6&63|128),t(63&n|128)),n=null}(e,r)})),t()}
/*!
     * +----------------------------------------------------------------------------------+
     * | murmurHash3.js v3.0.0 (http://github.com/karanlyons/murmurHash3.js)              |
     * | A TypeScript/JavaScript implementation of MurmurHash3's hashing algorithms.      |
     * |----------------------------------------------------------------------------------|
     * | Copyright (c) 2012-2020 Karan Lyons. Freely distributable under the MIT license. |
     * +----------------------------------------------------------------------------------+
     */function qt(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function Wt(e,t){return e<<t|e>>>32-t}function Ht(e,t){t=t||0;for(var n,r=(e=e||"").length%4,i=e.length-r,s=t,o=0,a=3432918353,u=461845907,c=0;c<i;c+=4)o=qt(o=255&e.charCodeAt(c)|(255&e.charCodeAt(c+1))<<8|(255&e.charCodeAt(c+2))<<16|(255&e.charCodeAt(c+3))<<24,a),o=qt(o=Wt(o,15),u),s=qt(s=Wt(s^=o,13),5)+3864292196;switch(o=0,r){case 3:o^=(255&e.charCodeAt(c+2))<<16;case 2:o^=(255&e.charCodeAt(c+1))<<8;case 1:o=qt(o^=255&e.charCodeAt(c),a),s^=o=qt(o=Wt(o,15),u)}return s^=e.length,n=s,n=qt(n^=n>>>16,2246822507),(s=(n=qt(n^=n>>>13,3266489909))^n>>>16)>>>0}function Qt(e,t){return Ht(Gt(e),t>>>0)}function Vt(e,t){return Math.abs(Qt(e,t)%100)+1}function Jt(e){return function(t){return e(t).then((function(e){return e.json()})).then((function(e){if(e.token){var t=(r=e.token,i=r.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),s=decodeURIComponent(Bt(i).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")),JSON.parse(s));if("number"!=typeof t.iat||"number"!=typeof t.exp)throw new Error('token properties "issuedAt" (iat) or "expiration" (exp) are missing or invalid');var n=JSON.parse(t["x-ably-capability"]);return se({decodedToken:t,channels:n},e)}var r,i,s;return e}))}}function Yt(e){return function(e){for(var t=String(e),n="",r=void 0,i=void 0,s=0,o=jt;t.charAt(0|s)||(o="=",s%1);n+=o.charAt(63&r>>8-s%1*8)){if((i=t.charCodeAt(s+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");r=r<<8|i}return n}(Qt(e,0).toString())}var Zt=/^control_/;var $t,Xt,en=function(){function e(e,t,n){if(this.eventSource=n&&n(),!this.eventSource)throw new Error("EventSource API is not available. ");this.streamingUrl=e.urls.streaming+"/sse",this.useHeaders=t,this.headers=function(e){var t={SplitSDKClientKey:f(e.core.authorizationKey)?e.core.authorizationKey.slice(-4):"",SplitSDKVersion:e.version},n=e.runtime,r=n.ip,i=n.hostname;return r&&(t.SplitSDKMachineIP=r),i&&(t.SplitSDKMachineName=i),t}(e)}return e.prototype.setEventHandler=function(e){this.handler=e},e.prototype.open=function(e){this.close();var t=Object.keys(e.channels).map((function(e){var t=Zt.test(e)?"[?occupancy=metrics.publishers]":"";return encodeURIComponent(t+e)})).join(","),n=this.streamingUrl+"?channels="+t+"&accessToken="+e.token+"&v=1.1&heartbeats=true";this.connection=new this.eventSource(this.useHeaders?n:n+"&SplitSDKVersion="+this.headers.SplitSDKVersion+"&SplitSDKClientKey="+this.headers.SplitSDKClientKey,this.useHeaders?{headers:this.headers}:void 0),this.handler&&(this.connection.addEventListener("open",this.handler.handleOpen),this.connection.addEventListener("message",this.handler.handleMessage),this.connection.addEventListener("error",this.handler.handleError))},e.prototype.close=function(){this.connection&&this.connection.close()},e}();function tn(e){return l(e)?e.matchingKey:e}function nn(e){return l(e)?{matchingKey:e.matchingKey,bucketingKey:e.bucketingKey}:{matchingKey:e,bucketingKey:e}}!function(e){e[e.None=0]="None",e[e.Gzip=1]="Gzip",e[e.Zlib=2]="Zlib"}($t||($t={})),function(e){e[e.UnboundedFetchRequest=0]="UnboundedFetchRequest",e[e.BoundedFetchRequest=1]="BoundedFetchRequest",e[e.KeyList=2]="KeyList",e[e.SegmentRemoval=3]="SegmentRemoval"}(Xt||(Xt={}));var rn=function(){if([typeof Uint8Array,typeof Uint16Array,typeof Uint32Array].some((function(e){return"function"!=e})))return"global Uint8Array object is not available for gzip/zlib decompression";var e=Uint8Array,t=Uint16Array,n=Uint32Array,r=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),o=function(e,r){for(var i=new t(31),s=0;s<31;++s)i[s]=r+=1<<e[s-1];var o=new n(i[30]);for(s=1;s<30;++s)for(var a=i[s];a<i[s+1];++a)o[a]=a-i[s]<<5|s;return[i,o]},a=o(r,2),u=a[0],c=a[1];u[28]=258,c[258]=28;for(var l=o(i,0)[0],f=new t(32768),h=0;h<32768;++h){var p=(43690&h)>>>1|(21845&h)<<1;p=(61680&(p=(52428&p)>>>2|(13107&p)<<2))>>>4|(3855&p)<<4,f[h]=((65280&p)>>>8|(255&p)<<8)>>>1}var g=function(e,n,r){for(var i=e.length,s=0,o=new t(n);s<i;++s)++o[e[s]-1];var a,u=new t(n);for(s=0;s<n;++s)u[s]=u[s-1]+o[s-1]<<1;if(r){a=new t(1<<n);var c=15-n;for(s=0;s<i;++s)if(e[s])for(var l=s<<4|e[s],h=n-e[s],p=u[e[s]-1]++<<h,g=p|(1<<h)-1;p<=g;++p)a[f[p]>>>c]=l}else for(a=new t(i),s=0;s<i;++s)e[s]&&(a[s]=f[u[e[s]-1]++]>>>15-e[s]);return a},d=new e(288);for(h=0;h<144;++h)d[h]=8;for(h=144;h<256;++h)d[h]=9;for(h=256;h<280;++h)d[h]=7;for(h=280;h<288;++h)d[h]=8;var m=new e(32);for(h=0;h<32;++h)m[h]=5;var v=g(d,9,1),y=g(m,5,1),b=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},T=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],w=function(e,t,n){var r=new Error(t||E[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,w),!n)throw r;return r},_=function(o,a,c){var f=o.length;if(!f||c&&c.f&&!c.l)return a||new e(0);var h=!a||c,p=!c||c.i;c||(c={}),a||(a=new e(3*f));var d=function(t){var n=a.length;if(t>n){var r=new e(Math.max(2*n,t));r.set(a),a=r}},m=c.f||0,E=c.p||0,_=c.b||0,k=c.l,C=c.d,N=c.m,R=c.n,A=8*f;do{if(!k){m=S(o,E,1);var O=S(o,E+1,3);if(E+=3,!O){var I=o[(z=4+((E+7)/8|0))-4]|o[z-3]<<8,L=z+I;if(L>f){p&&w(0);break}h&&d(_+I),a.set(o.subarray(z,L),_),c.b=_+=I,c.p=E=8*L,c.f=m;continue}if(1==O)k=v,C=y,N=9,R=5;else if(2==O){var D=S(o,E,31)+257,M=S(o,E+10,15)+4,x=D+S(o,E+5,31)+1;E+=14;for(var F=new e(x),K=new e(19),U=0;U<M;++U)K[s[U]]=S(o,E+3*U,7);E+=3*M;var P=b(K),j=(1<<P)-1,B=g(K,P,1);for(U=0;U<x;){var z,G=B[S(o,E,j)];if(E+=15&G,(z=G>>>4)<16)F[U++]=z;else{var q=0,W=0;for(16==z?(W=3+S(o,E,3),E+=2,q=F[U-1]):17==z?(W=3+S(o,E,7),E+=3):18==z&&(W=11+S(o,E,127),E+=7);W--;)F[U++]=q}}var H=F.subarray(0,D),Q=F.subarray(D);N=b(H),R=b(Q),k=g(H,N,1),C=g(Q,R,1)}else w(1);if(E>A){p&&w(0);break}}h&&d(_+131072);for(var V=(1<<N)-1,J=(1<<R)-1,Y=E;;Y=E){var Z=(q=k[T(o,E)&V])>>>4;if((E+=15&q)>A){p&&w(0);break}if(q||w(2),Z<256)a[_++]=Z;else{if(256==Z){Y=E,k=null;break}var $=Z-254;if(Z>264){var X=r[U=Z-257];$=S(o,E,(1<<X)-1)+u[U],E+=X}var ee=C[T(o,E)&J],te=ee>>>4;ee||w(3),E+=15&ee;Q=l[te];if(te>3){X=i[te];Q+=T(o,E)&(1<<X)-1,E+=X}if(E>A){p&&w(0);break}h&&d(_+131072);for(var ne=_+$;_<ne;_+=4)a[_]=a[_-Q],a[_+1]=a[_+1-Q],a[_+2]=a[_+2-Q],a[_+3]=a[_+3-Q];_=ne}}c.l=k,c.p=Y,c.b=_,c.f=m,k&&(m=1,c.m=N,c.d=C,c.n=R)}while(!m);return _==a.length?a:function(r,i,s){(null==i||i<0)&&(i=0),(null==s||s>r.length)&&(s=r.length);var o=new(r instanceof t?t:r instanceof n?n:e)(s-i);return o.set(r.subarray(i,s)),o}(a,0,_)};return{gunzipSync:function(t,n){return _(t.subarray(function(e){31==e[0]&&139==e[1]&&8==e[2]||w(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=e[10]|2+(e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)}(t),-8),n||new e((i=(r=t).length,(r[i-4]|r[i-3]<<8|r[i-2]<<16|r[i-1]<<24)>>>0)));var r,i},unzlibSync:function(e,t){return _(((8!=(15&(n=e)[0])||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&w(6,"invalid zlib data"),32&n[1]&&w(6,"invalid zlib data: preset dictionaries not supported"),e.subarray(2,-4)),t);var n}}}();function sn(e,t){var n,r=Bt(e),i=(n=r.split("").map((function(e){return e.charCodeAt(0)})),new Uint8Array(n));if("string"==typeof rn)throw new Error(rn);if(1===t)return rn.gunzipSync(i);if(2===t)return rn.unzlibSync(i);throw new Error("Invalid compression algorithm #"+t)}function on(e,t){var n,r=sn(e,t),i=(n=r,String.fromCharCode.apply(null,n));return JSON.parse(i.replace(/\d+/g,'"$&"'))}var an=function(){function e(e){var t=this;this.__setData__=[],Array.isArray(e)&&e.forEach((function(e){t.add(e)}))}return e.prototype.clear=function(){this.__setData__.length&&(this.__setData__.length=0)},e.prototype.add=function(e){return this.has(e)||this.__setData__.push(e),this},e.prototype.delete=function(e){var t=this.__setData__.indexOf(e);return-1!==t&&(this.__setData__.splice(t,1),!0)},e.prototype.has=function(e){return-1!==this.__setData__.indexOf(e)},e.prototype.forEach=function(e,t){if("function"!=typeof e)throw new TypeError(e+" is not a function");for(var n=0;n<this.__setData__.length;n++){var r=this.__setData__[n];e.call(t,r,r,this)}},Object.defineProperty(e.prototype,"size",{get:function(){return this.__setData__.length},enumerable:!1,configurable:!0}),e}();function un(e){return e instanceof an?e.__setData__.slice():Array.from(e)}var cn="function"==typeof Array.from&&"function"==typeof Set&&Set.prototype&&Set.prototype.values?Set:an;function ln(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function fn(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function hn(e,t){return 32===(t%=64)?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function pn(e,t){return 0===(t%=64)?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function gn(e,t){return[e[0]^t[0],e[1]^t[1]]}function dn(e){return e=gn(e,[0,e[0]>>>1]),e=gn(e=fn(e,[4283543511,3981806797]),[0,e[0]>>>1]),e=gn(e=fn(e,[3301882366,444984403]),[0,e[0]>>>1])}function mn(e,t){return function(e,t){t=t||0;for(var n=(e=e||"").length%16,r=e.length-n,i=[0,t],s=[0,t],o=[0,0],a=[0,0],u=[2277735313,289559509],c=[1291169091,658871167],l=0;l<r;l+=16)o=[255&e.charCodeAt(l+4)|(255&e.charCodeAt(l+5))<<8|(255&e.charCodeAt(l+6))<<16|(255&e.charCodeAt(l+7))<<24,255&e.charCodeAt(l)|(255&e.charCodeAt(l+1))<<8|(255&e.charCodeAt(l+2))<<16|(255&e.charCodeAt(l+3))<<24],a=[255&e.charCodeAt(l+12)|(255&e.charCodeAt(l+13))<<8|(255&e.charCodeAt(l+14))<<16|(255&e.charCodeAt(l+15))<<24,255&e.charCodeAt(l+8)|(255&e.charCodeAt(l+9))<<8|(255&e.charCodeAt(l+10))<<16|(255&e.charCodeAt(l+11))<<24],o=hn(o=fn(o,u),31),i=ln(i=hn(i=gn(i,o=fn(o,c)),27),s),i=ln(fn(i,[0,5]),[0,1390208809]),a=hn(a=fn(a,c),33),s=ln(s=hn(s=gn(s,a=fn(a,u)),31),i),s=ln(fn(s,[0,5]),[0,944331445]);switch(o=[0,0],a=[0,0],n){case 15:a=gn(a,pn([0,e.charCodeAt(l+14)],48));case 14:a=gn(a,pn([0,e.charCodeAt(l+13)],40));case 13:a=gn(a,pn([0,e.charCodeAt(l+12)],32));case 12:a=gn(a,pn([0,e.charCodeAt(l+11)],24));case 11:a=gn(a,pn([0,e.charCodeAt(l+10)],16));case 10:a=gn(a,pn([0,e.charCodeAt(l+9)],8));case 9:a=fn(a=gn(a,[0,e.charCodeAt(l+8)]),c),s=gn(s,a=fn(a=hn(a,33),u));case 8:o=gn(o,pn([0,e.charCodeAt(l+7)],56));case 7:o=gn(o,pn([0,e.charCodeAt(l+6)],48));case 6:o=gn(o,pn([0,e.charCodeAt(l+5)],40));case 5:o=gn(o,pn([0,e.charCodeAt(l+4)],32));case 4:o=gn(o,pn([0,e.charCodeAt(l+3)],24));case 3:o=gn(o,pn([0,e.charCodeAt(l+2)],16));case 2:o=gn(o,pn([0,e.charCodeAt(l+1)],8));case 1:o=fn(o=gn(o,[0,e.charCodeAt(l)]),u),i=gn(i,o=fn(o=hn(o,31),c))}return i=ln(i=gn(i,[0,e.length]),s=gn(s,[0,e.length])),s=ln(s,i),i=ln(i=dn(i),s=dn(s)),s=ln(s,i),("00000000"+(i[0]>>>0).toString(16)).slice(-8)+("00000000"+(i[1]>>>0).toString(16)).slice(-8)+("00000000"+(s[0]>>>0).toString(16)).slice(-8)+("00000000"+(s[1]>>>0).toString(16)).slice(-8)}(Gt(e),t>>>0)}function vn(e){var t,n,r,i=[0];for(t=0;t<e.length;t+=1){for(r=parseInt(e.charAt(t),16),n=i.length-1;n>=0;n-=1)i[n]=16*i[n]+r,r=i[n]/10|0,i[n]%=10;for(;r>0;)i.unshift(r%10),r=r/10|0}return i.join("")}function yn(e,t){var n,r=e.settings,i=e.storage,o=e.splitApi,a=e.readiness,u=e.platform,c=e.telemetryTracker,l=r.core.key?tn(r.core.key):void 0,f=r.log;try{n=new en(r,!l,u.getEventSource)}catch(e){return void f.warn(208,[e])}var h=Jt(o.fetchAuth),p=new u.EventEmitter,g=Ft(f,p,c);n.setEventHandler(g);var d,m,v,y,b=l?void 0:new Ut(t.segmentsSyncTask,i.segments),S=new Pt(i.splits,t.splitsSyncTask,a.splits,l?void 0:t.segmentsSyncTask),T={},E={},w=!1,_=new Dt(k,r.scheduler.pushRetryBackoffBase);function k(){if(!d){f.info(112),d=!1;var e=l?Object.keys(E):void 0;h(e).then((function(t){if(!d)return t.pushEnabled?void(e&&e.length<Object.keys(E).length||function(e){v&&clearTimeout(v),y&&clearTimeout(y);var t=e.decodedToken,r=t.exp-t.iat-600,i="number"==typeof e.connDelay&&e.connDelay>=0?e.connDelay:60;f.info(110,[r,i]),v=setTimeout(k,1e3*r),y=setTimeout((function(){d||n.open(e)}),1e3*i),c.streamingEvent(50,t.exp)}(t)):(f.info(113),void p.emit(St))})).catch((function(e){if(!d){if(f.error(306,[e.message]),e.statusCode>=400&&e.statusCode<500)return c.streamingEvent(80),void p.emit(St);p.emit(Tt)}}))}}function C(){d||(d=!0,n.close(),f.info(114),v&&clearTimeout(v),y&&clearTimeout(y),_.reset(),N())}function N(){S.backoff.reset(),l?s(E,(function(e){return e.worker.backoff.reset()})):b.backoff.reset()}return p.on(wt,N),p.on(Et,(function(){_.reset(),N()})),p.on(St,(function(){m=!0,C(),p.emit(wt)})),p.on(Tt,(function(){n.close();var e=_.scheduleCall();f.info(111,[e/1e3]),p.emit(wt)})),p.on(bt.STREAMING_RESET,(function(){d||(v&&clearTimeout(v),k())})),p.on(Nt,S.killSplit),p.on(Rt,S.put),l?(p.on(_t,(function(e,t){var n=t.split("_")[2],r=T[n];r&&E[r]&&E[r].worker.put(e.changeNumber,e.includesPayload?e.segmentList?e.segmentList:[]:void 0)})),p.on(kt,(function(e){switch(e.u){case Xt.BoundedFetchRequest:var t;try{o=e.d,a=e.c,t=sn(o,a)}catch(e){f.warn(F,["BoundedFetchRequest",e]);break}return void s(E,(function(n){var r,i,s,o,a=n.hash64,u=n.worker;r=t,i=a.hex,s=parseInt(i.slice(8),16)%(8*r.length),o=s%8,(r[Math.floor(s/8)]&1<<o)>0&&u.put(e.changeNumber)}));case Xt.KeyList:var n,r,i=void 0;try{i=on(e.d,e.c),n=new cn(i.a),r=new cn(i.r)}catch(e){f.warn(F,["KeyList",e]);break}return void s(E,(function(t){var i=t.hash64,s=t.worker,o=!!n.has(i.dec)||!r.has(i.dec)&&void 0;void 0!==o&&s.put(e.changeNumber,{name:e.segmentName,add:o})}));case Xt.SegmentRemoval:if(!e.segmentName){f.warn(F,["SegmentRemoval","No segment name was provided"]);break}return void s(E,(function(t){return t.worker.put(e.changeNumber,{name:e.segmentName,add:!1})}))}var o,a;s(E,(function(t){t.worker.put(e.changeNumber)}))}))):p.on(Ct,b.put),se(Object.create(p),{stop:function(){C(),l&&this.remove(l)},start:function(){m||!1===d||(d=!1,l?this.add(l,t.segmentsSyncTask):setTimeout(k))},isRunning:function(){return!1===d},add:function(e,t){var n,r,i=Yt(e);T[i]||(T[i]=e,E[e]={hash64:(n=e,r=mn(n).slice(0,16),{hex:r,dec:vn(r)}),worker:new Kt(t)},w=!0,setTimeout((function(){w&&(w=!1,k())}),0))},remove:function(e){var t=Yt(e);delete T[t],delete E[e]}})}function bn(e,t){return e<1?t:new Promise((function(n,r){var i=setTimeout((function(){r(new Error("Operation timed out because it exceeded the configured time limit of "+e+" ms."))}),e);t.then((function(e){clearTimeout(i),n(e)}),(function(e){clearTimeout(i),r(e)}))}))}function Sn(e,t,n,r,i,s,o,a){var u=!0,c=!0;function l(e){return c&&(e=bn(s,e)),e}function f(e){var t;if(Array.isArray(e))t=r.resetSegments(e);else{var s=e.name,o=e.add;r.isInSegment(s)!==o?(t=!0,o?r.addToSegment(s):r.removeFromSegment(s)):t=!1}n.usesSegments()&&(t||u)&&(u=!1,i.emit(Fe))}function h(n,r,i){return(r?new Promise((function(e){f(r),e(!0)})):t(a,i,l).then((function(e){return c=!1,f(e),!0}))).catch((function(t){return c&&o>n?(n+=1,e.warn(204,[n,t]),h(n)):(c=!1,!1)}))}return function(e,t){return h(0,e,t)}}function Tn(e){var t=new cn,n=e.reduce((function(e,n){return"ACTIVE"===n.status?(e.added.push([n.name,JSON.stringify(n)]),function(e){for(var t=e.conditions,n=new cn,r=0;r<t.length;r++)t[r].matcherGroup.matchers.forEach((function(e){"IN_SEGMENT"===e.matcherType&&n.add(e.userDefinedSegmentMatcherData.segmentName)}));return n}(n).forEach((function(e){t.add(e)}))):e.removed.push(n.name),e}),{added:[],removed:[],segments:[]});return n.segments=un(t),n}function En(e,t,n,r,i,s,o,a){void 0===s&&(s=0),void 0===o&&(o=0);var u=!0;function c(e){return u&&s&&(e=bn(s,e)),e}return function(s){return Promise.resolve(n.getChangeNumber()).then((function l(f,h){void 0===h&&(h=0),e.debug(31,[f]);var p=t(f,s,c).then((function(t){u=!1;var s=Tn(t.splits);return e.debug(32,[s.added.length]),e.debug(33,[s.removed.length]),e.debug(34,[s.segments.length]),Promise.all([n.setChangeNumber(t.till),n.addSplits(s.added),n.removeSplits(s.removed),r.registerSegments(s.segments)]).then((function(){return!i||Promise.resolve(!i.splitsArrived||f!==t.till&&(a||function(e){return Promise.resolve(e.getRegisteredSegments()).then((function(t){return Promise.all(t.map((function(t){return e.getChangeNumber(t)}))).then((function(e){return e.every((function(e){return-1!==e}))}))}))}(r))).catch((function(){return!1})).then((function(e){return e&&i.emit(Me),!0}))}))})).catch((function(t){return e.warn(205,[t]),u&&o>h?(h+=1,e.info(109,[h,t]),l(f,h)):(u=!1,!1)}));return i&&u&&Promise.resolve(n.checkCache()).then((function(e){e&&i.emit(xe)})),p}))}}function wn(e){var t=e.splitApi,n=e.storage,r=e.readiness,i=e.settings,o=i.log,a=function(e,t,n,r,i){return De(r.log,En(r.log,function(e){return function(t,n,r){var i=e(t,n);return r&&(i=r(i)),i.then((function(e){return e.json()}))}}(e),t.splits,t.segments,n.splits,r.startup.requestTimeoutBeforeReady,r.startup.retriesOnFailureBeforeReady,i),r.scheduler.featuresRefreshRate,"splitChangesUpdater")}(t.fetchSplitChanges,n,r,i,!0),u={},c=h(tn(i.core.key),r,n);function l(){s(u,(function(e){e.start()}))}function f(){s(u,(function(e){e.isRunning()&&e.stop()}))}function h(e,n,r){var s=function(e,t,n,r,i){return De(r.log,Sn(r.log,function(e){return function(t,n,r){var i=e(t,n);return r&&(i=r(i)),i.then((function(e){return e.json()})).then((function(e){return e.mySegments.map((function(e){return e.name}))}))}}(e),t.splits,t.segments,n.segments,r.startup.requestTimeoutBeforeReady,r.startup.retriesOnFailureBeforeReady,i),r.scheduler.segmentsRefreshRate,"mySegmentsUpdater")}(t.fetchMySegments,r,n,i,e);function o(){n.isReady()||r.splits.usesSegments()||n.segments.emit(Fe)}return r.splits.usesSegments()?n.splits.once(Me,o):setTimeout(o,0),u[e]=s,s}return r.splits.on(Me,(function(){if(a.isRunning()){var e=n.splits.usesSegments();e!==c.isRunning()&&(o.info(106,[e?"ON":"OFF"]),e?l():f())}})),{splitsSyncTask:a,segmentsSyncTask:c,start:function(){o.info(107),a.start(),n.splits.usesSegments()&&l()},stop:function(){o.info(108),a.isRunning()&&a.stop(),f()},isRunning:a.isRunning,syncAll:function(){var e=[a.execute()];return s(u,(function(t){e.push(t.execute())})),Promise.all(e)},add:h,remove:function(e){delete u[e]},get:function(e){return u[e]}}}function _n(e){return null!=e&&"function"==typeof e.then}function kn(e,t,n){return null==t||l(t)?t:(e.error(311,[n,"attributes"]),!1)}function Cn(e,t,n){if(!kn(e,t,n))return!1;var r=!0;return Object.keys(t).forEach((function(i){(function(e,t,n,r){if(!f(t)||0===t.length)return e.warn(r+": you passed an invalid attribute name, attribute name must be a non-empty string."),!1;var i=f(n),s=u(n),o=a(n),c=Array.isArray(n);return!!(i||s||o||c)||(e.warn(r+": you passed an invalid attribute value for "+t+". Acceptable types are: string, number, boolean and array of strings."),!1)})(e,i,t[i],n)||(r=!1)})),r}var Nn=/^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/,Rn="event_type";function An(e,t,n){if(null==t)e.error(K,[n,Rn]);else if(f(t))if(0===t.length)e.error(P,[n,Rn]);else{if(Nn.test(t))return t;e.error(310,[n,t])}else e.error(U,[n,Rn]);return!1}function On(e,t,n){return u(t)||null==t?t:(e.error(313,[n]),!1)}var In=0,Ln=2,Dn=4,Mn=8,xn=1024;function Fn(e,t,n){if(null==t)return{properties:null,size:xn};if(!l(t))return e.error(311,[n,"properties"]),{properties:!1,size:xn};var r=Object.keys(t),i=se({},t),s={properties:i,size:xn};r.length>300&&e.warn(212,[n]);for(var o=0;o<r.length;o++){s.size+=r[o].length*Ln;var c=i[r[o]],h=f(c),p=u(c),g=a(c),d=null===c;if(h||p||g||d||(i[r[o]]=null,c=null,d=!0,e.warn(211,[n,r[o]])),d?s.size+=In:p?s.size+=Mn:g?s.size+=Dn:h&&(s.size+=c.length*Ln),s.size>32768){e.error(312,[n]),s.properties=!1;break}}return s}function Kn(e,t,n){return!t.isDestroyed()||(e.error(314,[n]),!1)}function Un(e,t,n){return!(!t.isReady()&&!t.isReadyFromCache())||(e.warn(203,[n]),!1)}var Pn="definition not found",jn="not ready",Bn="exception";function zn(e,t,n,r,i){return!t.isReady()||r!==Pn&&null!=r||(e.warn(215,[i,n]),!1)}function Gn(e,t,n){e.warn(217,[n,t])}function qn(e){var t=e.conditions,n=r(t,(function(e){return"ROLLOUT"===e.conditionType}));return n||(n=t[0]),n?n.partitions.map((function(e){return e.treatment})):[]}function Wn(e){var t;try{t=JSON.parse(e)}catch(e){return null}return t?{name:t.name,trafficType:t.trafficTypeName,killed:t.killed,changeNumber:t.changeNumber||0,treatments:qn(t),configs:t.configurations||{}}:null}function Hn(e){var t=[];return e.forEach((function(e){var n=Wn(e);n&&t.push(n)})),t}function Qn(e,t,n){var r=n.readinessManager,i=n.sdkStatus,s="split";return se(Object.create(i),{split:function(n){var i=G(e,n,s);if(!Kn(e,r,s)||!Un(e,r,s)||!i)return null;var o=t.getSplit(i);return _n(o)?o.catch((function(){return null})).then((function(t){return zn(e,r,i,t,s),Wn(t)})):(zn(e,r,i,o,s),Wn(o))},splits:function(){if(!Kn(e,r,"splits")||!Un(e,r,"splits"))return[];var n=t.getAll();return _n(n)?n.catch((function(){return[]})).then(Hn):Hn(n)},names:function(){if(!Kn(e,r,"names")||!Un(e,r,"names"))return[];var n=t.getSplitNames();return _n(n)?n.catch((function(){return[]})):n}})}var Vn=function(){function e(){this.attributesCache={}}return e.prototype.setAttribute=function(e,t){return this.attributesCache[e]=t,!0},e.prototype.getAttribute=function(e){return this.attributesCache[e]},e.prototype.setAttributes=function(e){return this.attributesCache=se(this.attributesCache,e),!0},e.prototype.getAll=function(){return this.attributesCache},e.prototype.removeAttribute=function(e){return Object.keys(this.attributesCache).indexOf(e)>=0&&(delete this.attributesCache[e],!0)},e.prototype.clear=function(){return this.attributesCache={},!0},e}();function Jn(e,t,n,r){var i=function(e,t){var n=new Vn,r=t.getTreatment,i=t.getTreatmentWithConfig,s=t.getTreatments,o=t.getTreatmentsWithConfig,a=t.track;function u(e){var t=n.getAll();return Object.keys(t).length>0?se({},t,e):e}return se(t,{getTreatment:function(e,t,n){return r(e,t,u(n))},getTreatmentWithConfig:function(e,t,n){return i(e,t,u(n))},getTreatments:function(e,t,n){return s(e,t,u(n))},getTreatmentsWithConfig:function(e,t,n){return o(e,t,u(n))},track:function(e,t,n,r,i){return a(e,t,n,r,i)},setAttribute:function(t,r){var i={};return i[t]=r,!!Cn(e,i,"setAttribute")&&(e.debug("stored "+r+" for attribute "+t),n.setAttribute(t,r))},getAttribute:function(t){return e.debug("retrieved attribute "+t),n.getAttribute(t+"")},setAttributes:function(t){return!!Cn(e,t,"setAttributes")&&n.setAttributes(t)},getAttributes:function(){return n.getAll()},removeAttribute:function(t){return e.debug("removed attribute "+t),n.removeAttribute(t+"")},clearAttributes:function(){return n.clear()}})}(e,t);return se(i,{getTreatment:i.getTreatment.bind(i,n),getTreatmentWithConfig:i.getTreatmentWithConfig.bind(i,n),getTreatments:i.getTreatments.bind(i,n),getTreatmentsWithConfig:i.getTreatmentsWithConfig.bind(i,n),track:r?i.track.bind(i,n,r):i.track.bind(i,n),isClientSide:!0})}var Yn={UNDEFINED:0,ALL_KEYS:1,IN_SEGMENT:2,WHITELIST:3,EQUAL_TO:4,GREATER_THAN_OR_EQUAL_TO:5,LESS_THAN_OR_EQUAL_TO:6,BETWEEN:7,EQUAL_TO_SET:8,CONTAINS_ANY_OF_SET:9,CONTAINS_ALL_OF_SET:10,PART_OF_SET:11,ENDS_WITH:12,STARTS_WITH:13,CONTAINS_STRING:14,IN_SPLIT_TREATMENT:15,EQUAL_TO_BOOLEAN:16,MATCHES_STRING:17},Zn="BOOLEAN",$n="STRING",Xn="NUMBER",er="SET",tr="DATETIME",nr="NOT_SPECIFIED";function rr(e){return e.whitelist}function ir(e){return e.value}function sr(e){return new Date(e).setUTCHours(0,0,0,0)}function or(e){return new Date(e).setUTCSeconds(0,0)}function ar(e){var t=e.map((function(e){var t,n=e.matcherType,r=e.negate,i=e.keySelector,s=e.userDefinedSegmentMatcherData,o=e.whitelistMatcherData,a=e.unaryNumericMatcherData,u=e.betweenMatcherData,c=e.dependencyMatcherData,l=e.booleanMatcherData,f=e.stringMatcherData,h=i&&i.attribute,p=function(e){return Yn[e]||Yn.UNDEFINED}(n),g=$n,d=void 0;return p===Yn.IN_SEGMENT?d=(t=s)?t.segmentName:void 0:p===Yn.WHITELIST?d=function(e){return new cn(e.whitelist)}(o):p===Yn.EQUAL_TO?(d=ir(a),g=Xn,"DATETIME"===a.dataType&&(d=sr(d),g=tr)):p===Yn.GREATER_THAN_OR_EQUAL_TO||p===Yn.LESS_THAN_OR_EQUAL_TO?(d=ir(a),g=Xn,"DATETIME"===a.dataType&&(d=or(d),g=tr)):p===Yn.BETWEEN?(g=Xn,"DATETIME"===(d=u).dataType&&(d.start=or(d.start),d.end=or(d.end),g=tr)):p===Yn.EQUAL_TO_SET||p===Yn.CONTAINS_ANY_OF_SET||p===Yn.CONTAINS_ALL_OF_SET||p===Yn.PART_OF_SET?(d=rr(o),g=er):p===Yn.STARTS_WITH||p===Yn.ENDS_WITH||p===Yn.CONTAINS_STRING?d=rr(o):p===Yn.IN_SPLIT_TREATMENT?(d=c,g=nr):p===Yn.EQUAL_TO_BOOLEAN?(g=Zn,d=l):p===Yn.MATCHES_STRING&&(d=f),{attribute:h,negate:r,type:p,value:d,dataType:g}}));return-1===i(t,(function(e){return e.type===Yn.UNDEFINED}))?t:[]}var ur=function(){function e(e,t){if(100!==e[e.length-1])throw new RangeError("Provided invalid dataset as input");this._ranges=e,this._treatments=t}return e.parse=function(t){var n=t.reduce((function(e,t){var n=t.size,r=t.treatment;return e.ranges.push(e.inc+=n),e.treatments.push(r),e}),{inc:0,ranges:[],treatments:[]});return new e(n.ranges,n.treatments)},e.prototype.getTreatmentFor=function(e){if(e<0||e>100)throw new RangeError("Please provide a value between 0 and 100");var t=i(this._ranges,(function(t){return e<=t}));return this._treatments[t]},e}();var cr=[void 0,function(e){return function(t){return e.debug(4),null!=t}},function(e,t,n){return function(r){var i=n.segments.isInSegment(t,r);return _n(i)?i.then((function(n){return e.debug(18,[t,r,i]),n})):e.debug(18,[t,r,i]),i}},function(e,t){return function(n){var r=t.has(n);return e.debug(22,[n,un(t).join(","),r]),r}},function(e,t){return function(n){var r=n===t;return e.debug(12,[n,t,r]),r}},function(e,t){return function(n){var r=n>=t;return e.debug(15,[n,t,r]),r}},function(e,t){return function(n){var r=n<=t;return e.debug(16,[n,t,r]),r}},function(e,t){return function(n){var r=n>=t.start&&n<=t.end;return e.debug(5,[n,t.start,t.end,r]),r}},function(e,t){return function(n){for(var r=n.length===t.length,s=function(e){i(t,(function(t){return t===n[e]}))<0&&(r=!1)},o=0;o<n.length&&r;o++)s(o);return e.debug(13,[n,t,r]),r}},function(e,t){return function(n){for(var r=!1,s=function(e){i(n,(function(n){return n===t[e]}))>=0&&(r=!0)},o=0;o<t.length&&!r;o++)s(o);return e.debug(8,[n,t,r]),r}},function(e,t){return function(n){var r=!0;if(n.length<t.length)r=!1;else for(var s=function(e){i(n,(function(n){return n===t[e]}))<0&&(r=!1)},o=0;o<t.length&&r;o++)s(o);return e.debug(7,[n,t,r]),r}},function(e,t){return function(n){for(var r=n.length<=t.length,s=function(e){i(t,(function(t){return t===n[e]}))<0&&(r=!1)},o=0;o<n.length&&r;o++)s(o);return e.debug(17,[n,t,r]),r}},function(e,t){return function(n){var r=t.some((function(e){return r=e,void 0===i&&(i=!1),!(!f(t=n)||!f(r))&&(i&&(t=t.toLowerCase(),r=r.toLowerCase()),t.slice(t.length-r.length)===r);var t,r,i}));return e.debug(14,[n,t,r]),r}},function(e,t){return function(n){var r=t.some((function(e){return g(n,e)}));return e.debug(21,[n,t,r]),r}},function(e,t){return function(n){var r=t.some((function(e){return f(n)&&n.indexOf(e)>-1}));return e.debug(9,[n,t,r]),r}},function(e,t,n){var r=t.split,i=t.treatments;function s(t,n,r){var i=!1;return Array.isArray(n)&&(i=-1!==n.indexOf(t.treatment)),e.debug(10,[r,t.treatment,t.label,r,n,i]),i}return function(t,o){var a=t.key,u=t.attributes;e.debug(11,[r,JSON.stringify(a),u?"\n attributes: "+JSON.stringify(u):""]);var c=o(e,a,r,u,n);return _n(c)?c.then((function(e){return s(e,i,r)})):s(c,i,r)}},function(e,t){return function(n){var r=t===n;return e.debug(6,[t,n]),r}},function(e,t){return function(n){var r;try{r=new RegExp(t)}catch(n){return e.debug(20,[t]),!1}var i=r.test(n);return e.debug(19,[n,t,i?"yes":"no"]),i}}];function lr(e,t,n){var r,i=t.type,s=t.value;return cr[i]&&(r=cr[i](e,s,n)),r}function fr(e,t){return{key:e,attributes:t}}function hr(e,t,n,r,i){var s,o,a=function(e,t){switch(e){case Yn.EQUAL_TO:return"DATETIME"===t?sr:void 0;case Yn.GREATER_THAN_OR_EQUAL_TO:case Yn.LESS_THAN_OR_EQUAL_TO:case Yn.BETWEEN:return"DATETIME"===t?or:void 0;case Yn.IN_SPLIT_TREATMENT:return fr;default:return}}(t,r);switch(r){case Xn:case tr:o=d(n),s=isNaN(o)?void 0:o;break;case $n:s=function(e){var t=e;return l(e)&&(t=e.matchingKey?e.matchingKey:void 0),m(t)||void 0}(n);break;case er:s=function(e){var t=Array.isArray(e)?v(e.map((function(e){return e+""}))):[];return t.length?t:void 0}(n);break;case Zn:s=function(e){if(!0===e||!1===e)return e;if("string"==typeof e){var t=e.toLocaleLowerCase();if("true"===t)return!0;if("false"===t)return!1}}(n);break;case nr:s=n;break;default:s=void 0}return a&&(s=a(s,i)),e.debug(24,[n,r,s instanceof Object?JSON.stringify(s):s]),s}function pr(e,t,n,r){var i=n.attribute,s=function(e,t,n,r){var i=void 0;return n?r?(i=r[n],e.debug(23,[n,i])):e.warn(201,[n]):i=t,i}(e,t,i,r),o=hr(e,n.type,s,n.dataType,r);return void 0!==o?o:void e.warn(200,[s+(i?" for attribute "+i:"")])}function gr(e,t,n,r,i,s){if(t)return{treatment:function(e,t,n,r){var i=Vt(t,n),s=r.getTreatmentFor(i);return e.debug(3,[i,t,n,s]),s}(e,n,r,i),label:s}}function dr(e,t,n,r,i){return function(s,o,a,u,c,l){if("ROLLOUT"===i&&!function(e,t,n){return!(e<100&&Vt(t,n)>e)}(a,s.bucketingKey,u))return{treatment:void 0,label:"not in split"};var f=t(s,c,l);return _n(f)?f.then((function(t){return gr(e,t,s.bucketingKey,o,n,r)})):gr(e,f,s.bucketingKey,o,n,r)}}function mr(e,t){function n(t){var n=t.every((function(e){return e}));return e.debug(0,[n]),n}return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var s=t.map((function(t){return t.apply(void 0,e)}));return-1!==i(s,_n)?Promise.all(s).then(n):n(s)}}function vr(e,t,n){for(var r=[],s=0;s<t.length;s++){var o=t[s],a=o.matcherGroup,u=o.partitions,c=o.label,l=o.conditionType,f=ar(a.matchers).map((function(t){var r=lr(e,t,n);return function(n,i,s){var o=pr(e,n,t,i),a=!(void 0===o||!r)&&r(o,s);return _n(a)?a.then((function(e){return Boolean(e^t.negate)})):Boolean(a^t.negate)}}));if(0===f.length){r=[];break}r.push(dr(e,mr(e,f),ur.parse(u),c,l))}return function(e,t){function n(t){for(var n=t.length,r=0;r<n;r++){var i=t[r];if(void 0!==i)return e.debug(1,[i.treatment]),i}e.debug(2)}return!Array.isArray(t)||Array.isArray(t)&&0===t.length?function(){return e.error(300),{treatment:y,label:Bn}}:function(e,r,s,o,a,u){var c=t.map((function(t){return t(e,r,s,o,a,u)}));return-1!==i(c,_n)?Promise.all(c).then((function(e){return n(e)})):n(c)}}(e,r)}function yr(e,t){return{treatment:o(e,"treatment",t),label:o(e,"label","default rule")}}var br=function(){function e(e,t){this.baseInfo=e,this.evaluator=t,"string"!=typeof this.baseInfo.defaultTreatment&&(this.baseInfo.defaultTreatment=y)}return e.parse=function(t,n,r){return new e(n,vr(t,n.conditions,r))},e.prototype.getKey=function(){return this.baseInfo.name},e.prototype.getTreatment=function(e,t,n){var r,i,s,o=this.baseInfo,a=o.killed,u=o.seed,c=o.defaultTreatment,l=o.trafficAllocation,f=o.trafficAllocationSeed;try{r=nn(e)}catch(e){return{treatment:y,label:Bn}}if(this.isGarbage())i=y,s="archived";else{if(!a){var h=this.evaluator(r,u,l,f,t,n);return _n(h)?h.then((function(e){return yr(e,c)})):yr(h,c)}i=c,s="killed"}return{treatment:i,label:s}},e.prototype.isGarbage=function(){return"ARCHIVED"===this.baseInfo.status},e.prototype.getChangeNumber=function(){return this.baseInfo.changeNumber},e}(),Sr={treatment:y,label:Bn,config:null};function Tr(e){var t={};return e.forEach((function(e){t[e]=Sr})),t}function Er(e,t,n,r,i){var s;try{s=i.splits.getSplit(n)}catch(e){return Sr}return _n(s)?s.then((function(n){return wr(e,n,t,r,i)})).catch((function(){return Sr})):wr(e,s,t,r,i)}function wr(e,t,n,r,i){var s={treatment:y,label:Pn,config:null};if(t){var o=JSON.parse(t),a=br.parse(e,o,i);if(_n(s=a.getTreatment(n,r,Er)))return s.then((function(e){return e.changeNumber=a.getChangeNumber(),e.config=o.configurations&&o.configurations[e.treatment]||null,e}));s.changeNumber=a.getChangeNumber(),s.config=o.configurations&&o.configurations[s.treatment]||null}return s}function _r(e,t,n,r,i,s){var o={},a=[];return t.forEach((function(t){var u=wr(e,n[t],r,i,s);_n(u)?a.push(u.then((function(e){o[t]=e}))):o[t]=u})),a.length>0?Promise.all(a).then((function(){return o})):o}function kr(e){var t=e.sdkReadinessManager.readinessManager,n=e.storage,r=e.settings,i=e.impressionsTracker,s=e.eventTracker,o=e.telemetryTracker,a=r.log,u=r.mode;function c(e,t,r,s){void 0===s&&(s=!1);var u=o.trackEval(s?"tc":"t"),c=function(n){var o=[],a=h(n,t,e,r,s,"getTreatment"+(s?"withConfig":""),o);return i.track(o,r),u(o[0]&&o[0].label),a},l=Er(a,e,t,r,n);return _n(l)?l.then((function(e){return c(e)})):c(l)}function f(e,t,r,s){void 0===s&&(s=!1);var u=o.trackEval(s?"tcs":"ts"),c=function(t){var n=[],o={};return Object.keys(t).forEach((function(i){o[i]=h(t[i],i,e,r,s,"getTreatments"+(s?"withConfig":""),n)})),i.track(n,r),u(n[0]&&n[0].label),o},l=function(e,t,n,r,i){var s;try{s=i.splits.getSplits(n)}catch(e){return Tr(n)}return _n(s)?s.then((function(s){return _r(e,n,s,t,r,i)})).catch((function(){return Tr(n)})):_r(e,n,s,t,r,i)}(a,e,t,r,n);return _n(l)?l.then((function(e){return c(e)})):c(l)}function h(e,n,r,i,s,o,u){var c=t.isReady()||t.isReadyFromCache(),f=tn(r),h=function(e){return l(e)?e.bucketingKey:void 0}(r);c||(e={treatment:y,label:jn});var p=e.treatment,g=e.label,d=e.changeNumber,m=e.config,v=void 0===m?null:m;return a.info(102,[n,f,p,g]),zn(a,t,n,g,o)&&(a.info(103),u.push({feature:n,keyName:f,treatment:p,time:Date.now(),bucketingKey:h,label:g,changeNumber:d})),s?{treatment:p,config:v}:p}return{getTreatment:c,getTreatmentWithConfig:function(e,t,n){return c(e,t,n,!0)},getTreatments:f,getTreatmentsWithConfig:function(e,t,n){return f(e,t,n,!0)},track:function(e,r,i,c,l,f){void 0===f&&(f=1024);var h=o.trackEval("tr"),p=tn(e),g={eventTypeId:i,trafficTypeName:r,value:c,timestamp:Date.now(),key:p,properties:l};!function(e,t,n,r,i,s){if(!t.isReady()||r===k)return!0;var o=n.trafficTypeExists(i);_n(o)?o.then((function(t){return t||Gn(e,i,s),t})):o||Gn(e,i,s)}(a,t,n.splits,u,r,"track");var d=s.track(g,f);return _n(d)?d.then((function(e){return h(),e})):(h(),d)},isClientSide:!1}}function Cr(e){return[N,C,A].indexOf(e.mode)>-1}function Nr(e){return!!Cr(e)&&e.sync.impressionsMode===_}function Rr(e){return-1===[R,A].indexOf(e.mode)}function Ar(e,t){var n=e.sdkReadinessManager,r=e.syncManager,i=e.storage,s=e.signalListener,o=e.settings,a=e.telemetryTracker;return se(Object.create(n.sdkStatus),function(e,t,n){var r=e.log,i=Rr(e);function s(e,t,i,s){var o=g(s,"getTreatments"),a=V(r,e,s),u=o?q(r,t,s):G(r,t,s),c=kn(r,i,s),l=Kn(r,n,s);return Un(r,n,s),{valid:l&&a&&u&&!1!==c,key:a,splitOrSplits:u,attributes:c}}function o(e){return i?e:Promise.resolve(e)}return{getTreatment:function(e,n,r){var i=s(e,n,r,"getTreatment");return i.valid?t.getTreatment(i.key,i.splitOrSplits,i.attributes):o(y)},getTreatmentWithConfig:function(e,n,r){var i=s(e,n,r,"getTreatmentWithConfig");return i.valid?t.getTreatmentWithConfig(i.key,i.splitOrSplits,i.attributes):o(se({},b))},getTreatments:function(e,n,r){var i=s(e,n,r,"getTreatments");if(i.valid)return t.getTreatments(i.key,i.splitOrSplits,i.attributes);var a={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(e){return a[e]=y})),o(a)},getTreatmentsWithConfig:function(e,n,r){var i=s(e,n,r,"getTreatmentsWithConfig");if(i.valid)return t.getTreatmentsWithConfig(i.key,i.splitOrSplits,i.attributes);var a={};return i.splitOrSplits&&i.splitOrSplits.forEach((function(e){return a[e]=se({},b)})),o(a)},track:function(e,s,o,a,u){var c=V(r,e,"track"),l=Z(r,s,"track"),f=An(r,o,"track"),h=On(r,a,"track"),p=Fn(r,u,"track"),g=p.properties,d=p.size;return Kn(r,n,"track")&&c&&l&&f&&!1!==h&&!1!==g?t.track(c,l,f,h,g,d):!i&&Promise.resolve(!1)}}}(o,kr(e),n.readinessManager),{destroy:function(){return t||a.sessionLength(),r&&r.stop(),(r?r.flush():Promise.resolve()).then((function(){var e;return n.readinessManager.destroy(),s&&s.stop(),t||(e=o.core.authorizationKey,lt[e]&&lt[e]--,0===lt[e]&&delete lt[e]),i.destroy()}))}})}function Or(e){return(e.matchingKey?e.matchingKey:e)+"-"+(e.bucketingKey?e.bucketingKey:e)+"-"}function Ir(e){var t=e.storage,n=e.syncManager,r=e.sdkReadinessManager,i=e.settings,s=i.core.key,o=i.startup.readyTimeout,a=i.log,u=Jn(a,Ar(e),s),c=Or(nn(s)),l={};return l[c]=u,function(i){if(void 0===i)return a.debug(27),u;var s=V(a,i,"Client instantiation");if(!1===s)throw new Error("Shared Client needs a valid key.");var c=Or(s);if(l[c])a.debug(28);else{var f=tn(s),h=r.shared(o),p=t.shared&&t.shared(f,(function(e){e||h.readinessManager.segments.emit(Fe)})),g=n&&p&&n.shared(f,h.readinessManager,p);l[c]=Jn(a,Ar(se({},e,{sdkReadinessManager:h,storage:p||t,syncManager:g,signalListener:void 0}),!0),s),g&&g.start(),a.info(104)}return l[c]}}var Lr="unload",Dr="for unload page event.",Mr=function(){function e(e,t,n,r){this.syncManager=e,this.settings=t,this.storage=n,this.serviceApi=r,this.flushData=this.flushData.bind(this),this.fromImpressionsCollector=rt.bind(void 0,t.core.labelsEnabled)}return e.prototype.start=function(){"undefined"!=typeof window&&window.addEventListener&&(this.settings.log.debug(25,[Dr]),window.addEventListener(Lr,this.flushData))},e.prototype.stop=function(){"undefined"!=typeof window&&window.removeEventListener&&(this.settings.log.debug(26,[Dr]),window.removeEventListener(Lr,this.flushData))},e.prototype.flushData=function(){if(this.syncManager){if(It(this.settings)){var e=this.settings.urls.events,t={sim:this.settings.sync.impressionsMode===_?_:w};if(this._flushData(e+"/testImpressions/beacon",this.storage.impressions,this.serviceApi.postTestImpressionsBulk,this.fromImpressionsCollector,t),this._flushData(e+"/events/beacon",this.storage.events,this.serviceApi.postEventsBulk),this.storage.impressionCounts&&this._flushData(e+"/testImpressions/count/beacon",this.storage.impressionCounts,this.serviceApi.postTestImpressionsCount,st),this.storage.telemetry){var n=this.settings.urls.telemetry,r=pt(this.storage.telemetry,this.storage.splits,this.storage.segments);this._flushData(n+"/v1/metrics/usage/beacon",r,this.serviceApi.postMetricsUsage)}}this.syncManager.pushManager&&this.syncManager.pushManager.stop()}},e.prototype._flushData=function(e,t,n,r,i){if(!t.isEmpty()){var s=r?r(t.state()):t.state();this._sendBeacon(e,s,i)||n(JSON.stringify(s)).catch((function(){})),t.clear()}},e.prototype._sendBeacon=function(e,t,n){if("undefined"!=typeof navigator&&navigator.sendBeacon){var r={entries:t,token:this.settings.core.authorizationKey,sdk:this.settings.version};n&&se(r,n);var i=JSON.stringify(r);return navigator.sendBeacon(e,i)}return!1},e}(),xr=function(e,t,n,r){this.list=r,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null},Fr=function(){function e(){this.tail=null,this.head=null,this.length=0}return e.prototype.removeNode=function(e){if(e&&e instanceof xr){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t}},e.prototype.unshiftNode=function(e){if(e&&e instanceof xr&&e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},e.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)this.head=new xr(arguments[e],null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},e}(),Kr=function(){function e(e){this.maxLen=e||1,this.items=new ae,this.lru=new Fr}return e.prototype.get=function(e){var t=this.items.get(e);if(t&&t instanceof xr)return this.lru.unshiftNode(t),t.value.value},e.prototype.set=function(e,t){var n=this.items.get(e);if(n){if(!(n instanceof xr))return!1;this.lru.unshiftNode(n),this.lru.head.value.value=t}else{if(this.lru.length===this.maxLen){var r=this.lru.tail;if(!r)return!1;this.items.delete(r.value.key),this.lru.removeNode(this.lru.tail)}this.lru.unshift({key:e,value:t}),this.items.set(e,this.lru.head)}return!0},e}(),Ur=function(){function e(e,t){this.cache=new Kr(e),this.hasher=t}return e.prototype.testAndSet=function(e){var t=this.hasher(e),n=this.cache.get(t);return this.cache.set(t,e.time),n},e}();function Pr(e){return Qt(function(e){return e.keyName+":"+e.feature+":"+e.treatment+":"+e.label+":"+e.changeNumber}(e))}function jr(){return new Ur(500,Pr)}function Br(e,t){var n=[];if(e.forEach((function(e){var r=e(t);r&&r.queue&&n.push(r)})),0!==n.length)return{handleImpression:function(e){n.forEach((function(t){return t.queue({type:T,payload:e})}))},handleEvent:function(e){n.forEach((function(t){return t.queue({type:E,payload:e})}))}}}var zr,Gr,qr={GRANTED:D,DECLINED:M,UNKNOWN:x};function Wr(e){var t=e.settings,n=e.settings.log,r=e.syncManager,i=e.storage,s=i.events,o=i.impressions,u=i.impressionCounts;return It(t)||n.info(124,[t.userConsent]),{setStatus:function(e){var i,c;if(!a(e))return n.warn(325,["UserConsent.setStatus"]),!1;var l=e?D:M;return t.userConsent!==l?(n.info(122,[t.userConsent,l]),t.userConsent=l,e?null===(i=null==r?void 0:r.submitter)||void 0===i||i.start():(null===(c=null==r?void 0:r.submitter)||void 0===c||c.stop(),s.clear&&s.clear(),o.clear&&o.clear(),u&&u.clear())):n.info(123,[l]),!0},getStatus:function(){return t.userConsent},Status:qr}}function Hr(e,t){var n=!1,r=!1;var i=function e(i){var s=new Promise((function(e,n){return i.then(e,(function(e){r?n(e):t(e)}))})),o=s.then;return Object.defineProperty(s,"then",{value:function(t,i){var a=o.call(s,t,i);return"function"==typeof t&&(n=!0),"function"==typeof i?(r=!0,a):e(a)}}),s}(e);return i.hasOnFulfilled=function(){return n},i}function Qr(e,t,n){void 0===t&&(t=0),void 0===n&&(n=function(e){var t=se(new e,{splitsArrived:!1,splitsCacheLoaded:!1});return t.on(Me,(function(e){e||(t.splitsArrived=!0)})),t.once(xe,(function(){t.splitsCacheLoaded=!0})),t}(e));var r=function(e){var t=se(new e,{segmentsArrived:!1});return t.once(Fe,(function(){t.segmentsArrived=!0})),t}(e),i=new e,s=!1;n.splitsCacheLoaded?s=!0:n.once(xe,(function(){if(s=!0,!u)try{i.emit(Pe)}catch(e){setTimeout((function(){throw e}),0)}}));var o,a=!1;t>0&&(o=setTimeout((function(){a=!0,i.emit(Ke,"Split SDK emitted SDK_READY_TIMED_OUT event.")}),t));var u=!1;n.on(Me,l),r.on(Fe,l);var c=!1;function l(e){if(u)try{i.emit(je,e)}catch(e){setTimeout((function(){throw e}),0)}else if(n.splitsArrived&&r.segmentsArrived){clearTimeout(o),u=!0;try{i.emit(Ue)}catch(e){setTimeout((function(){throw e}),0)}}}var f=1;return{splits:n,segments:r,gate:i,shared:function(t){return void 0===t&&(t=0),f++,Qr(e,t,n)},destroy:function(){c=!0,r.removeAllListeners(),i.removeAllListeners(),clearTimeout(o),f>0&&f--,0===f&&n.removeAllListeners()},isReady:function(){return u},hasTimedout:function(){return a},isReadyFromCache:function(){return s},isDestroyed:function(){return c},isOperational:function(){return(u||s)&&!c}}}function Vr(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=Qr(t,n));var i=0,s=0;r.gate.on("removeListener",(function(e){e===Ue&&s--})),r.gate.on("newListener",(function(t){t!==Ue&&t!==Ke||(r.isReady()?e.error(302,[t===Ue?"SDK_READY":"SDK_READY_TIMED_OUT"]):t===Ue&&s++)}));var o,a=o=Hr(new Promise((function(t,n){r.gate.once(Ue,(function(){e.info(101),s!==i||o.hasOnFulfilled()||e.warn(202),t()})),r.gate.once(Ke,(function(e){n(new Error(e))}))})),u);function u(t){e.error(t&&t.message)}return r.gate.once(Pe,(function(){e.info(100)})),{readinessManager:r,shared:function(n){return void 0===n&&(n=0),Vr(e,t,n,r.shared(n))},incInternalReadyCbCount:function(){i++},sdkStatus:se(Object.create(r.gate),{Event:{SDK_READY:Ue,SDK_READY_FROM_CACHE:Pe,SDK_UPDATE:je,SDK_READY_TIMED_OUT:Ke},ready:function(){return r.hasTimedout()?r.isReady()?Promise.resolve():Hr(Promise.reject(new Error("Split SDK has emitted SDK_READY_TIMED_OUT event.")),u):a},__getStatus:function(){return{isReady:r.isReady(),isReadyFromCache:r.isReadyFromCache(),isOperational:r.isOperational(),hasTimedout:r.hasTimedout(),isDestroyed:r.isDestroyed()}}})}}function Jr(e){function t(t){le(t)?e.setLogLevel(t):e.error(301)}return{enable:function(){t(ue.DEBUG)},setLogLevel:t,disable:function(){t(ue.NONE)},LogLevel:ue}}function Yr(e){return{s:e.version,i:e.runtime.ip||S,n:e.runtime.hostname||S}}function Zr(e){var t=e.settings,n=e.platform,r=e.storageFactory,i=e.splitApiFactory,s=e.extraProps,o=e.syncManagerFactory,a=e.SignalListener,u=e.impressionsObserverFactory,c=e.integrationsManagerFactory,l=e.sdkManagerFactory,f=e.sdkClientMethodFactory,h=t.log;ft(h,t.core.authorizationKey);var p=Vr(h,n.EventEmitter,t.startup.readyTimeout),g=p.readinessManager,d=r({impressionsQueueSize:t.scheduler.impressionsQueueSize,eventsQueueSize:t.scheduler.eventsQueueSize,optimize:Nr(t),matchingKey:tn(t.core.key),splitFiltersValidation:t.sync.__splitFiltersValidation,mode:t.mode,onReadyCb:function(e){e||(g.splits.emit(Me),g.segments.emit(Fe))},metadata:Yr(t),log:h}),m=c&&c({settings:t,storage:d}),v=u&&u(),y=function(e,t,n,r,i,s){var o=e.log,a=e.impressionListener,u=e.runtime,c=u.ip,l=u.hostname,f=e.version;return{track:function(u,h){if(e.userConsent!==M){var p=u.length,g=[];u.forEach((function(e){r&&(e.pt=r.testAndSet(e));var t=Date.now();i&&i.track(e.feature,t,1),(!i||!e.pt||e.pt<_e(t))&&g.push(e)}));var d=t.track(g);if(_n(d)?d.then((function(){o.info(121,[p])})).catch((function(e){o.error(307,[p,e])})):s&&(s.recordImpressionStats(0,g.length),s.recordImpressionStats(2,u.length-g.length)),a||n)for(var m=function(e){var t={impression:se({},u[e]),attributes:h,ip:c,hostname:l,sdkLanguageVersion:f};setTimeout((function(){n&&n.handleImpression(t);try{a&&a.logImpression(t)}catch(e){o.error(308,[e])}}),0)},v=0;v<p;v++)m(v)}}}}(t,d.impressions,m,v,d.impressionCounts,d.telemetry),b=function(e,t,n,r){var i=e.log,s=Rr(e);function o(e,t){var r='event of type "'+e.eventTypeId+'" for traffic type "'+e.trafficTypeName+'". Key: '+e.key+". Value: "+e.value+". Timestamp: "+e.timestamp+". "+(e.properties?"With properties.":"With no properties.");return t?(i.info(120,[r]),n&&setTimeout((function(){var t=se({},e);e.properties&&(t.properties=se({},e.properties)),n.handleEvent(t)}),0)):i.error(309,[r]),t}return{track:function(n,i){if(e.userConsent===M)return!s&&Promise.resolve(!1);var a=t.track(n,i);return _n(a)?a.then(o.bind(null,n)):(r&&r.recordEventStats(a?0:1,1),o(n,a))}}}(t,d.events,m,d.telemetry),S=function(e,t){if(e&&t){var n=ht(t);return{trackEval:function(n){var r=ht(t);return function(t){switch(t){case Bn:return void e.recordException(n);case jn:e.recordNonReadyUsage&&e.recordNonReadyUsage()}e.recordLatency(n,r())}},trackHttp:function(n){var r=ht(t);return function(t){e.recordHttpLatency(n,r()),t&&t.statusCode?e.recordHttpError(n,t.statusCode):e.recordSuccessfulSync(n,Date.now())}},sessionLength:function(){e.recordSessionLength&&e.recordSessionLength(n())},streamingEvent:function(t,n){80===t?e.recordAuthRejections():(e.recordStreamingEvents({e:t,d:n,t:Date.now()}),50===t&&e.recordTokenRefreshes())}}}var r=function(){return function(){}};return{trackEval:r,trackHttp:r,sessionLength:function(){},streamingEvent:function(){}}}(d.telemetry,n.now),T=i&&i(t,n,S),E={splitApi:T,eventTracker:b,impressionsTracker:y,telemetryTracker:S,sdkReadinessManager:p,readiness:g,settings:t,storage:d,platform:n},w=o&&o(E);E.syncManager=w;var _=a&&new a(w,t,d,T);E.signalListener=_;var k=f(E),C=l(h,d.splits,p);return w&&w.start(),_&&_.start(),h.info(105),se({client:k,manager:function(){return h.debug(29),C},Logger:Jr(t.log),settings:t},s&&s(E))}function $r(e,t){return t=t||{},new Promise((function(n,r){var i=new XMLHttpRequest,s=[],o=[],a={},u=function(){return{ok:2==(i.status/100|0),statusText:i.statusText,status:i.status,url:i.responseURL,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(i.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([i.response]))},clone:u,headers:{keys:function(){return s},entries:function(){return o},get:function(e){return a[e.toLowerCase()]},has:function(e){return e.toLowerCase()in a}}}};for(var c in i.open(t.method||"get",e,!0),i.onload=function(){i.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(e,t,n){s.push(t=t.toLowerCase()),o.push([t,n]),a[t]=a[t]?a[t]+","+n:n})),n(u())},i.onerror=r,i.withCredentials="include"==t.credentials,t.headers)i.setRequestHeader(c,t.headers[c]);i.send(t.body||null)}))}var Xr="object"==typeof Reflect?Reflect:null,ei=Xr&&"function"==typeof Xr.apply?Xr.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},ti=function e(){e.init.call(this)};function ni(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function ri(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ii(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}ti.prototype._events=void 0,ti.prototype._eventsCount=0,ti.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0)},ti.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var a=i[e];if(void 0===a)return!1;if("function"==typeof a)ei(a,this,t);else for(var u=a.length,c=ii(a,u),l=0;l<u;++l)ei(c[l],this,t);return!0},ti.prototype.addListener=function(e,t){return function(e,t,n,r){var i,s;return ni(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),s=i[t]),void 0===s?(s=i[t]=n,++e._eventsCount):"function"==typeof s?s=i[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),e}(this,e,t,!1)},ti.prototype.on=ti.prototype.addListener,ti.prototype.once=function(e,t){return ni(t),this.on(e,function(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=ri.bind(r);return i.listener=n,r.wrapFn=i,i}(this,e,t)),this},ti.prototype.removeListener=function(e,t){var n,r,i,s,o;if(ni(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},ti.prototype.off=ti.prototype.removeListener,ti.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this};var si={getFetch:function(){return"function"==typeof fetch?fetch:$r},getEventSource:function(){return"function"==typeof EventSource?EventSource:void 0},EventEmitter:ti,now:"object"==typeof performance&&"function"==typeof performance.now?performance.now.bind(performance):Date.now};function oi(e,t){var n=function(e,t){zr||(zr=Lt(wn,yn));var n={settings:e,platform:t,storageFactory:e.storage,splitApiFactory:Ze,syncManagerFactory:zr,sdkManagerFactory:Qn,sdkClientMethodFactory:Ir,SignalListener:Mr,integrationsManagerFactory:e.integrations&&e.integrations.length>0?Br.bind(null,e.integrations):void 0,impressionsObserverFactory:Cr(e)?jr:void 0,extraProps:function(e){return{UserConsent:Wr(e)}}};switch(e.mode){case k:n.splitApiFactory=void 0,n.syncManagerFactory=e.sync.localhostMode,n.SignalListener=void 0;break;case R:n.syncManagerFactory=void 0;break;case A:Gr||(Gr=Lt(void 0,void 0)),n.syncManagerFactory=Gr}return n}(function(e){return ee(e,Qe)}(e),si);return t&&t(n),Zr(n)}var ai=/[^.]+$/;var ui=function(e){function n(t,n){var r=e.call(this,t)||this;return r.matchingKey=n,r.regexSplitsCacheKey=new RegExp("^"+t+"\\.(splits?|trafficType)\\."),r}return t(n,e),n.prototype.buildSegmentNameKey=function(e){return this.prefix+"."+this.matchingKey+".segment."+e},n.prototype.extractSegmentName=function(e){var t=this.prefix+"."+this.matchingKey+".segment.";if(g(e,t))return e.substr(t.length)},n.prototype.buildOldSegmentNameKey=function(e){return this.matchingKey+"."+this.prefix+".segment."+e},n.prototype.extractOldSegmentKey=function(e){var t=this.matchingKey+"."+this.prefix+".segment.";if(g(e,t))return e.substr(t.length)},n.prototype.buildLastUpdatedKey=function(){return this.prefix+".splits.lastUpdated"},n.prototype.isSplitsCacheKey=function(e){return this.regexSplitsCacheKey.test(e)},n.prototype.buildSplitsFilterQueryKey=function(){return this.prefix+".splits.filterQuery"},n}(function(){function e(e){void 0===e&&(e="SPLITIO"),this.prefix=e}return e.prototype.buildTrafficTypeKey=function(e){return this.prefix+".trafficType."+e},e.prototype.buildSplitKey=function(e){return this.prefix+".split."+e},e.prototype.buildSplitsTillKey=function(){return this.prefix+".splits.till"},e.prototype.isSplitKey=function(e){return g(e,this.prefix+".split.")},e.prototype.buildSplitKeyPrefix=function(){return this.prefix+".split."},e.prototype.buildSplitsWithSegmentCountKey=function(){return this.prefix+".splits.usingSegments"},e.prototype.buildSegmentNameKey=function(e){return this.prefix+".segment."+e},e.prototype.buildSegmentTillKey=function(e){return this.prefix+".segment."+e+".till"},e.prototype.extractKey=function(e){var t=e.match(ai);if(t&&t.length)return t[0];throw new Error("Invalid latency key provided")},e}());var ci="storage:localstorage: ",li=function(e){function n(t,n,r,i){void 0===i&&(i={queryString:null,groupedFilters:{byName:[],byPrefix:[]},validFilters:[]});var s=e.call(this)||this;return s.log=t,s.cacheReadyButNeedsToFlush=!1,s.keys=n,s.splitFiltersValidation=i,s._checkExpiration(r),s._checkFilterQuery(),s}return t(n,e),n.prototype._decrementCount=function(e){var t=d(localStorage.getItem(e))-1;t>0?localStorage.setItem(e,t):localStorage.removeItem(e)},n.prototype._decrementCounts=function(e){try{if(e){if(e.trafficTypeName){var t=this.keys.buildTrafficTypeKey(e.trafficTypeName);this._decrementCount(t)}if(ye(e)){var n=this.keys.buildSplitsWithSegmentCountKey();this._decrementCount(n)}}}catch(e){this.log.error(ci+e)}},n.prototype._incrementCounts=function(e){try{if(e){if(e.trafficTypeName){var t=this.keys.buildTrafficTypeKey(e.trafficTypeName);localStorage.setItem(t,d(localStorage.getItem(t))+1)}if(ye(e)){var n=this.keys.buildSplitsWithSegmentCountKey();localStorage.setItem(n,d(localStorage.getItem(n))+1)}}}catch(e){this.log.error(ci+e)}},n.prototype.clear=function(){this.log.info(ci+"Flushing Splits data from localStorage");for(var e=localStorage.length,t=[],n=0;n<e;n++){var r=localStorage.key(n);null!=r&&this.keys.isSplitsCacheKey(r)&&t.push(r)}t.forEach((function(e){localStorage.removeItem(e)})),this.hasSync=!1},n.prototype.addSplit=function(e,t){try{var n=this.keys.buildSplitKey(e),r=localStorage.getItem(n),i=r?JSON.parse(r):null;this._decrementCounts(i),localStorage.setItem(n,t);var s=t?JSON.parse(t):null;return this._incrementCounts(s),!0}catch(e){return this.log.error(ci+e),!1}},n.prototype.removeSplit=function(e){try{var t=this.getSplit(e);localStorage.removeItem(this.keys.buildSplitKey(e));var n=JSON.parse(t);return this._decrementCounts(n),!0}catch(e){return this.log.error(ci+e),!1}},n.prototype.getSplit=function(e){return localStorage.getItem(this.keys.buildSplitKey(e))},n.prototype.setChangeNumber=function(e){if(this.cacheReadyButNeedsToFlush&&(this.clear(),this.cacheReadyButNeedsToFlush=!1),this.updateNewFilter){this.log.info(ci+"Split filter query was modified. Updating cache.");var t=this.keys.buildSplitsFilterQueryKey(),n=this.splitFiltersValidation.queryString;try{n?localStorage.setItem(t,n):localStorage.removeItem(t)}catch(e){this.log.error(ci+e)}this.updateNewFilter=!1}try{return localStorage.setItem(this.keys.buildSplitsTillKey(),e+""),localStorage.setItem(this.keys.buildLastUpdatedKey(),Date.now()+""),this.hasSync=!0,!0}catch(e){return this.log.error(ci+e),!1}},n.prototype.getChangeNumber=function(){var e=localStorage.getItem(this.keys.buildSplitsTillKey());return null!==e?c(e=parseInt(e,10))?-1:e:-1},n.prototype.getSplitNames=function(){for(var e=localStorage.length,t=[],n=0;n<e;){var r=localStorage.key(n);null!=r&&this.keys.isSplitKey(r)&&t.push(this.keys.extractKey(r)),n++}return t},n.prototype.trafficTypeExists=function(e){var t=d(localStorage.getItem(this.keys.buildTrafficTypeKey(e)));return u(t)&&t>0},n.prototype.usesSegments=function(){if(!this.hasSync)return!0;var e=localStorage.getItem(this.keys.buildSplitsWithSegmentCountKey()),t=null===e?0:d(e);return!u(t)||t>0},n.prototype.checkCache=function(){return this.getChangeNumber()>-1||this.cacheReadyButNeedsToFlush},n.prototype._checkExpiration=function(e){var t=localStorage.getItem(this.keys.buildLastUpdatedKey());null!==t&&!c(t=parseInt(t,10))&&e&&t<e&&this.clear()},n.prototype._checkFilterQuery=function(){var e=this,t=this.splitFiltersValidation,n=t.queryString,r=t.groupedFilters,i=this.keys.buildSplitsFilterQueryKey();if(localStorage.getItem(i)!==n)try{this.updateNewFilter=!0,this.checkCache()&&(localStorage.setItem(this.keys.buildSplitsTillKey(),"-1"),this.getSplitNames().forEach((function(t){n&&(r.byName.indexOf(t)>-1||r.byPrefix.some((function(e){return t.startsWith(e+"__")})))?e.cacheReadyButNeedsToFlush=!0:e.removeSplit(t)})))}catch(e){this.log.error(ci+e)}},n}(ve),fi=function(e){function n(t,n){var r=e.call(this)||this;return r.log=t,r.keys=n,r}return t(n,e),n.prototype.clear=function(){this.log.info(ci+"Flushing MySegments data from localStorage"),this.resetSegments([])},n.prototype.addToSegment=function(e){var t=this.keys.buildSegmentNameKey(e);try{return localStorage.setItem(t,"1"),!0}catch(e){return this.log.error(ci+e),!1}},n.prototype.removeFromSegment=function(e){var t=this.keys.buildSegmentNameKey(e);try{return localStorage.removeItem(t),!0}catch(e){return this.log.error(ci+e),!1}},n.prototype.isInSegment=function(e){return"1"===localStorage.getItem(this.keys.buildSegmentNameKey(e))},n.prototype.resetSegments=function(e){var t,n=this,r=!1,i=Object.keys(localStorage).reduce((function(t,r){var i=n.keys.extractSegmentName(r);if(i)t.push(i);else if(i=n.keys.extractOldSegmentKey(r)){var s=n.keys.buildSegmentNameKey(i);try{!localStorage.getItem(s)&&e.indexOf(i)>-1&&(localStorage.setItem(s,"1"),t.push(i)),localStorage.removeItem(r)}catch(e){n.log.error(e)}}return t}),[]);if(0===e.length&&i.length===e.length)return r;if(i.length!==e.length)r=!0,i.forEach((function(e){return n.removeFromSegment(e)})),e.forEach((function(e){return n.addToSegment(e)}));else{for(t=0;t<e.length&&-1!==i.indexOf(e[t]);t++);t<e.length&&(r=!0,i.forEach((function(e){return n.removeFromSegment(e)})),e.forEach((function(e){return n.addToSegment(e)})))}return r},n.prototype.getRegisteredSegments=function(){var e=this;return Object.keys(localStorage).reduce((function(t,n){var r=e.keys.extractSegmentName(n);return r&&t.push(r),t}),[])},n.prototype.getKeysCount=function(){return 1},n}(Se);var hi="ga-to-split: ",pi="ga-to-split:mapper";var gi,di=(gi={eventTypeId:{event:"eventAction",social:"socialAction"},eventValue:{event:"eventValue",timing:"timingValue"},eventProperties:{pageview:["page"],screenview:["screenName"],event:["eventCategory","eventLabel"],social:["socialNetwork","socialTarget"],timing:["timingCategory","timingVar","timingLabel"],exception:["exDescription","exFatal"]}},function(e){var t=e.get("hitType"),n=e.get(gi.eventTypeId[t]||"hitType"),r=e.get(gi.eventValue[t]),i={},s=gi.eventProperties[t];if(s)for(var o=0;o<s.length;o++)i[s[o]]=e.get(s[o]);return{eventTypeId:n,value:r,properties:i,timestamp:Date.now()}});function mi(e){return Array.isArray(e)?function(e,t){void 0===t&&(t=JSON.stringify);var n={};return e.filter((function(e){var r=t(e);return!Object.prototype.hasOwnProperty.call(n,r)&&(n[r]=!0)}))}(e).filter((function(e){if(!e)return!1;var t=e.key,n=e.trafficType;return!(!f(t)&&!u(t))&&!!f(n)})):[]}var vi=/^[^a-zA-Z0-9]+/,yi=/[^-_.:a-zA-Z0-9]+/g;function bi(e,t){var n,r,i,s=t.storage,o=t.settings,a=o.core,c=o.log,l={prefix:"ga",identities:a.key&&a.trafficType?[{key:a.key,trafficType:a.trafficType}]:void 0};n="splitTracker",r=function(t,n){var r=se({},l,e,n);this.tracker=t;var i=mi(r.identities);if(0!==i.length){var o=i.length-r.identities.length;o&&c.warn(hi+(o+" identities were discarded because they are invalid or duplicated. Identities must be an array of objects with key and trafficType.")),r.identities=i,f(r.prefix)||(c.warn(hi+"The provided `prefix` was ignored since it is invalid. Please check that you are passing a string object as `prefix`."),r.prefix=void 0);var a=t.get("sendHitTask");t.set("sendHitTask",(function(e){if(a(e),!1!==r.hits&&!e.get("splitHit")){try{if(r.filter&&!r.filter(e))return}catch(e){return void c.warn(hi+"custom filter threw: "+e)}var t=di(e);if(r.mapper){try{t=r.mapper(e,t)}catch(e){return void c.warn(hi+"custom mapper threw: "+e)}if(!t)return}r.prefix&&(t.eventTypeId=r.prefix+"."+t.eventTypeId),t.eventTypeId=function(e,t){if(!f(t)||0===t.length)return t;var n=t.replace(vi,"").replace(yi,"_"),r=n.slice(0,80);return r.length<n.length&&e.warn(hi+"EventTypeId was truncated because it cannot be more than 80 characters long."),r}(c,t.eventTypeId),function(e,t){return!(!An(e,t.eventTypeId,pi)||!1===On(e,t.value,pi)||!1===Fn(e,t.properties,pi).properties||t.timestamp&&!u(t.timestamp)||t.key&&!1===V(e,t.key,pi)||t.trafficTypeName&&!1===Z(e,t.trafficTypeName,pi))}(c,t)&&(t.key&&t.trafficTypeName?s.events.track(t):r.identities.forEach((function(e){var n=se({key:e.key,trafficTypeName:e.trafficType},t);s.events.track(n)})))}})),c.info(hi+"integration started")}else c.warn(hi+"No valid identities were provided. Please check that you are passing a valid list of identities or providing a traffic type at the SDK configuration.")},i=window.GoogleAnalyticsObject||"ga",window[i]=window[i]||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];(window[i].q=window[i].q||[]).push(e)},window[i]("provide",n,r)}var Si="split-to-ga: ",Ti="`ga` command queue not found.",Ei="No hit was sent.",wi=function(){function e(t,n){this.trackerNames=e.defaultTrackerNames,this.log=t,n&&("function"==typeof n.filter&&(this.filter=n.filter),"function"==typeof n.mapper&&(this.mapper=n.mapper),Array.isArray(n.trackerNames)&&(this.trackerNames=v(n.trackerNames)),this.impressions=n.impressions,this.events=n.events),t.info(Si+"integration started"),"function"!=typeof e.getGa()&&t.warn(Si+(Ti+" No hits will be sent until it is available."))}return e.defaultMapper=function(e){var t=e.type,n=e.payload;switch(t){case T:return{hitType:"event",eventCategory:"split-impression",eventAction:"Evaluate "+n.impression.feature,eventLabel:"Treatment: "+n.impression.treatment+". Targeting rule: "+n.impression.label+".",nonInteraction:!0};case E:return{hitType:"event",eventCategory:"split-event",eventAction:n.eventTypeId,eventValue:n.value,nonInteraction:!0}}},e.getGa=function(){return"undefined"!=typeof window?window[window.GoogleAnalyticsObject||"ga"]:void 0},e.validateFieldsObject=function(e,t){return!(!t||!t.hitType)||(e.warn(Si+"your custom mapper returned an invalid FieldsObject instance. It must be an object with at least a `hitType` field."),!1)},e.prototype.queue=function(t){var n=e.getGa();if(n){if(!1===this.impressions&&t.type===T)return;if(!1===this.events&&t.type===E)return;var r;try{if(this.filter&&!this.filter(t))return;if(r=e.defaultMapper(t),this.mapper&&(!(r=this.mapper(t,r))||!e.validateFieldsObject(this.log,r)))return}catch(e){return void this.log.warn(Si+"queue method threw: "+e+". "+Ei)}this.trackerNames.forEach((function(e){var t=e?e+".send":"send";r.splitHit=!0,n(t,r)}))}else this.log.warn(Si+(Ti+" ")+Ei)},e.defaultTrackerNames=[""],e}();var _i=[[300,"engine:combiner: Invalid Split, no valid rules found"],[301,"logger: Invalid Log Level - No changes to the logs will be applied."],[303,"The SDK will not get ready. Reason: %s"],[307,"impressions-tracker: Could not store impressions bulk with %s impression(s). Error: %s"],[308,"impressions-tracker: Impression listener logImpression method threw: %s."],[309,"events-tracker: Failed to queue %s"],[304,"sync:offline: There was an issue loading the mock Splits data, no changes will be applied to the current cache. %s"],[305,"sync:streaming: Failed to connect or error on streaming connection, with error message: %s"],[306,"sync:streaming: Failed to authenticate for streaming. Error: %s."],[322,"Response status is not OK. Status: %s. URL: %s. Message: %s"],[302,"A listener was added for %s on the SDK, which has already fired and won't be emitted again. The callback won't be executed."],[314,"%s: Client has already been destroyed - no calls possible."],[310,'%s: you passed "%s", event_type must adhere to the regular expression /^[a-zA-Z0-9][-_.:a-zA-Z0-9]{0,79}$/g. This means an event_type must be alphanumeric, cannot be more than 80 characters long, and can only include a dash, underscore, period, or colon as separators of alphanumeric characters.'],[311,"%s: %s must be a plain object."],[312,"%s: the maximum size allowed for the properties is 32768 bytes, which was exceeded. Event not queued."],[313,"%s: value must be a finite number."],[K,"%s: you passed a null or undefined %s. It must be a non-empty string."],[316,"%s: %s too long. It must have 250 characters or less."],[317,"%s: Key must be an object with bucketingKey and matchingKey with valid string properties."],[U,"%s: you passed an invalid %s. It must be a non-empty string."],[P,"%s: you passed an empty %s. It must be a non-empty string."],[320,"%s: %s must be a non-empty array."],[325,"%s: provided param must be a boolean value."],[321,'settings: you passed an invalid "%s" config param. It should be one of the following values: %s. Defaulting to "%s".'],[323,'settings: an invalid value was received for "sync.localhostMode" config. A valid entity should be provided for localhost mode.'],[324,"settings: the provided storage is invalid.%s Falling back into default MEMORY storage"],[326,'settings: the provided "%s" config param is lower than allowed. Setting to the minimum value %s seconds']];var ki=_i.concat([[200,"engine:value: Value %s doesn't match with expected type."],[201,"engine:value: Defined attribute [%s], no attributes received."],[204,"sync:my-segments: Retrying download of segments #%s. Reason: %s"],[205,"sync:split-changes: Error while doing fetch of Splits. %s"],[206,"sync:streaming: Error parsing SSE error notification: %s"],[207,"sync:streaming: Error parsing SSE message notification: %s"],[208,"sync:streaming: Falling back to polling mode. Reason: %s"],[209,"sync:submitter: Droping %s after retry. Reason: %s."],[210,"sync:submitter: Failed to push %s, keeping data to retry on next iteration. Reason: %s."],[203,"%s: the SDK is not ready, results may be incorrect. Make sure to wait for SDK readiness before using this method."],[202,"No listeners for SDK Readiness detected. Incorrect control treatments could have been logged if you called getTreatment/s while the SDK was not yet ready."],[211,'%s: Property "%s" is of invalid type. Setting value to null.'],[212,"%s: Event has more than 300 properties. Some of them will be trimmed when processed."],[213,'%s: %s "%s" is not of type string, converting.'],[214,'%s: %s "%s" has extra whitespace, trimming.'],[215,'%s: split "%s" does not exist in this environment, please double check what splits exist in the Split web console.'],[216,"%s: traffic_type_name should be all lowercase - converting string to lowercase."],[217,'%s: traffic type "%s" does not have any corresponding split in this environment, make sure you\'re tracking your events to a valid traffic type defined in the Split web console.'],[218,"settings: %s integration item(s) at settings is invalid. %s"],[219,'settings: split filters have been configured but will have no effect if mode is not "%s", since synchronization is being deferred to an external tool.'],[220,'settings: split filter at position %s is invalid. It must be an object with a valid filter type ("byName" or "byPrefix") and a list of "values".'],[221,"settings: splitFilters configuration must be a non-empty array of filter objects."],[222,"settings: You already have %s. We recommend keeping only one instance of the factory at all times (Singleton pattern) and reusing it throughout your application"],[F,"sync:streaming: Fetching MySegments due to an error processing %s notification: %s"]]);var Ci="Split SDK is ready",Ni=ki.concat([[100,Ci+" from cache"],[101,Ci],[102,"impressions-tracker: Split: %s. Key: %s. Evaluation: %s. Label: %s"],[103,"impressions-tracker: Queueing corresponding impression."],[104,"New shared client instance created."],[105,"New Split SDK instance created."],[120,"events-tracker: Successfully queued %s"],[121,"impressions-tracker: Successfully stored %s impression(s)."],[122,"UserConsent: consent status changed from %s to %s."],[123,"UserConsent: call had no effect because it was the current consent status (%s)."],[124,"Starting the SDK with %s user consent. No data will be sent."],[106,"sync:polling-manager: Turning segments data polling %s."],[107,"sync:polling-manager: Starting polling"],[108,"sync:polling-manager: Stopping polling"],[109,"sync:split-changes: Retrying download of splits #%s. Reason: %s"],[115,"sync:submitter: Flushing full %s queue and reseting timer."],[116,"sync:submitter: Pushing %s."],[110,"sync:streaming: Refreshing streaming token in %s seconds, and connecting streaming in %s seconds."],[111,"sync:streaming: Attempting to reconnect streaming in %s seconds."],[112,"sync:streaming: Connecting streaming."],[113,"sync:streaming: Streaming is disabled for given Api key. Switching to polling mode."],[114,"sync:streaming: Disconnecting streaming."],[117,"sync:sync-manager: Streaming not available. Starting polling."],[118,"sync:sync-manager: Streaming couldn't connect. Continue polling."],[119,"sync:sync-manager: Streaming connected. Syncing and stopping polling."]]);var Ri=Ni.concat([[0,"engine:combiner: [andCombiner] evaluates to %s"],[1,"engine:combiner: Treatment found: %s"],[2,"engine:combiner: All predicates evaluated, no treatment found."],[3,'engine: using algo "murmur" bucket %s for key %s using seed %s - treatment %s'],[4,"engine:matcher: [allMatcher] is always true"],[5,"engine:matcher: [betweenMatcher] is %s between %s and %s? %s"],[6,"engine:matcher: [booleanMatcher] %s === %s"],[7,"engine:matcher: [containsAllMatcher] %s contains all elements of %s? %s"],[8,"engine:matcher: [containsAnyMatcher] %s contains at least an element of %s? %s"],[9,"engine:matcher: [containsStringMatcher] %s contains %s? %s"],[10,'engine:matcher: [dependencyMatcher] parent split "%s" evaluated to "%s" with label "%s". %s evaluated treatment is part of [%s] ? %s.'],[11,'engine:matcher: [dependencyMatcher] will evaluate parent split: "%s" with key: %s %s'],[12,"engine:matcher: [equalToMatcher] is %s equal to %s? %s"],[13,"engine:matcher: [equalToSetMatcher] is %s equal to set %s? %s"],[14,"engine:matcher: [endsWithMatcher] %s ends with %s? %s"],[15,"engine:matcher: [greaterThanEqualMatcher] is %s greater than %s? %s"],[16,"engine:matcher: [lessThanEqualMatcher] is %s less than %s? %s"],[17,"engine:matcher: [partOfMatcher] %s is part of %s? %s"],[18,"engine:matcher: [segmentMatcher] evaluated %s / %s => %s"],[19,"engine:matcher: [stringMatcher] does %s matches with %s? %s"],[20,"engine:matcher: [stringMatcher] %s is an invalid regex"],[21,"engine:matcher: [startsWithMatcher] %s starts with %s? %s"],[22,"engine:matcher: [whitelistMatcher] evaluated %s in [%s] => %s"],[23,"engine:value: Extracted attribute [%s], [%s] will be used for matching."],[24,"engine:sanitize: Attempted to sanitize [%s] which should be of type [%s]. Sanitized and processed value => [%s]"],[25,"cleanup: Registering cleanup handler %s"],[26,"cleanup: Deregistering cleanup handler %s"],[27,"Retrieving default SDK client."],[28,"Retrieving existing SDK client."],[29,"Retrieving manager instance."],[30,"sync:offline: Splits data: \n%s"],[31,"sync:split-changes: Spin up split update using since = %s"],[32,"sync:split-changes: New splits %s"],[33,"sync:split-changes: Removed splits %s"],[34,"sync:split-changes: Segment names collected %s"],[35,"sync:streaming: New SSE message received, with data: %s."],[36,"sync: Starting %s. Running each %s millis"],[37,"sync: Running %s"],[38,"sync: Stopping %s"],[39,'settings: splits filtering criteria is "%s".']]);return oi.SplitFactory=oi,oi.InLocalStorage=function(e){void 0===e&&(e={});var t=function(e){return e?e+".SPLITIO":"SPLITIO"}(e.prefix);function n(e){if(!function(){var e="__SPLITSOFTWARE__";try{return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}())return e.log.warn(ci+"LocalStorage API is unavailable. Falling back to default MEMORY storage"),Ae(e);var n=e.log,r=new ui(t,e.matchingKey),i=Date.now()-864e6;return{splits:new li(n,r,i,e.splitFiltersValidation),segments:new fi(n,r),impressions:new Ee(e.impressionsQueueSize),impressionCounts:e.optimize?new ke:void 0,events:new we(e.eventsQueueSize),telemetry:e.mode!==k&&Ne()?new Re:void 0,destroy:function(){this.splits=new be,this.segments=new Te,this.impressions.clear(),this.impressionCounts&&this.impressionCounts.clear(),this.events.clear()},shared:function(e){var r=new ui(t,e);return{splits:this.splits,segments:new fi(n,r),impressions:this.impressions,impressionCounts:this.impressionCounts,events:this.events,telemetry:this.telemetry,destroy:function(){this.splits=new be,this.segments=new Te}}}}}return n.type=I,n},oi.GoogleAnalyticsToSplit=function(e){function t(t){return bi(e,t)}return t.type="GOOGLE_ANALYTICS_TO_SPLIT",t},oi.SplitToGoogleAnalytics=function(e){function t(t){return new wi(t.settings.log,e)}return void 0===e&&(e={}),t.type="SPLIT_TO_GOOGLE_ANALYTICS",t},oi.ErrorLogger=function(){return new ge({logLevel:"ERROR"},new ae(_i))},oi.WarnLogger=function(){return new ge({logLevel:"WARN"},new ae(ki))},oi.InfoLogger=function(){return new ge({logLevel:"INFO"},new ae(Ni))},oi.DebugLogger=function(){return new ge({logLevel:"DEBUG"},new ae(Ri))},oi}));





	

